# 模型关节和动画操作

## 目录

- [1.获取模型关节](#1获取模型关节)
- [2.设置模型关节数据](#2设置模型关节数据)
- [3.获取模型动画](#3获取模型动画)
- [4.设置模型动画](#4设置模型动画)
- [5.播放模型动画](#5播放模型动画)
- [6.开始关节变换](#6开始关节变换)
- [7.结束关节变换](#7结束关节变换)
- [8.开始播放动画](#8开始播放动画)
- [9.结束播放动画](#9结束播放动画)

## 1.获取模型关节

### 功能描述

获取模型关节

### 调用方法

```js
let jsonData = {
  id: 'modelId1',
  layerId: "layerId",
};
appInstance.uniCall('getModelArticulation', jsonData, (result) => {
  console.log(result);
});
```

#### 参数描述

| 属性 | 类型  | 说明                                                                |
| ---- | ----- | ------------------------------------------------------------------- |
| id  | String | 模型对象 id，新建时调用者自己传入的唯一标识，用于各种操作的对象识别 |
| layerId  | String | 模型所属的图层Id，Id可以通过getModelsByType接口获得。如果这个为空，会在场景世界中查找并且设置第一个对应Id和Ids的对象，如果不为空，只会查找指定layerId图层内的匹配Id和Ids的模型对象。 |

#### 回调数据

```json
{
  "result": 1, // result 为执行结果，1 代表成功，0 代表失败；
  "message": "成功。", // message 为成功或失败消息；
  "id": "modelId", // 返回当前模型包含的全部关节定义信息
  "data": [
    {
      "articulation": "articulationName01", // 关节名称
      "type": "float", // 关节类型, float / enum / bool / string
      "currentValue": "10", // 关节当前的值
      "minValue": "5", // float类型的最小值
      "maxValue": "15" // float类型的最大值
    },
    {
      "articulation": "articulationName02", // 关节名称
      "type": "enum", // 关节类型, float / enum / bool / string
      "currentValue": "Enum1", // 关节当前的值
      "value": ["Enum1", "Enum2"] // 枚举类型对应的全部枚举值数组
    },
    {
      "articulation": "articulationName03", // 关节名称
      "currentValue": "true", // 关节当前的值
      "type": "bool" // 关节类型, 布尔类型的为"true" / "false"
    },
    {
      "articulation": "articulationName03", // 关节名称
      "currentValue": "Hello", // 关节当前的值
      "type": "streaming" // 关节类型,  string类型的值为任意
    }
  ]
}
```

#### 回调数据参数描述

| 属性                 | 类型   | 说明                                   |
| -------------------- | ------ | -------------------------------------- |
| result               | Number | 1：代表成功；0：代表失败               |
| message              | String | 成功或者失败原因                       |
| id                   | String | 返回当前模型包含的全部关节定义信息     |
| data                 | Array  | 获取模型关节数据                       |
| data[0].articulation | String | 关节名称                               |
| data[0].type         | String | 关节类型, float / enum / bool / string |
| data[0].currentValue | String | 关节当前的值                           |
| data[0].minValue     | String | float 类型的最小值                     |
| data[0].maxValue     | String | float 类型的最大值                     |
| data[0].value        | Array  | 枚举类型对应的全部枚举值数组           |

[返回本章目录](#目录)

## 2.设置模型关节数据

### 功能描述

设置三维场景中模型关节数据

### 调用方法

```js
let jsonData = {
  id: 'modelId',
  layerId: "layerId",
  duration: 1,
  data: [
    {
      articulation: 'articulationName01',
      type: 'float',
      value: '15',
    },
  ],
};
appInstance.uniCall('setModelArticulation', jsonData, (result) => {
  console.log(result);
});
```

#### 参数描述

| 属性                 | 类型   | 说明                                                                |
| -------------------- | ------ | ------------------------------------------------------------------- |
| id                   | String | 模型对象 id，新建时调用者自己传入的唯一标识，用于各种操作的对象识别 |
| layerId                   | String | 模型所属的图层Id，Id可以通过getModelsByType接口获得。如果这个为空，会在场景世界中查找并且设置第一个对应Id和Ids的对象，如果不为空，只会查找指定layerId图层内的匹配Id和Ids的模型对象。 |
| duration             | Number | 更新数据时长，在这个时间周期内进行差值动画（单位：秒）              |
| data                 | Array  | 定义模型关节数据                                                    |
| data[0].articulation | String | 关节名称                                                            |
| data[0].type         | String | 关节类型，float：浮点型关节、enum：枚举型关节；bool：布尔型关节     |
| data[0].value        | String | 关节取值（字符串类型）                                              |

#### 回调数据

```json
{
  "result": 1,
  "message": "成功。"
}
```

#### 回调数据参数描述

| 属性    | 类型   | 说明                     |
| ------- | ------ | ------------------------ |
| result  | Number | 1：代表成功；0：代表失败 |
| message | String | 成功或者失败原因         |

[返回本章目录](#目录)

## 3.获取模型动画

### 功能描述

获取模型动画

### 调用方法

```js
let jsonData = {
  id: 'modelId',
  layerId: "layerId",
};

appInstance.uniCall('getModelAnimation', jsonData, (result) => {
  console.log(result);
});
```

#### 参数描述

| 属性 | 类型   | 说明                                                                |
| ---- | ------ | ------------------------------------------------------------------- |
| id   | String | 模型对象 id，新建时调用者自己传入的唯一标识，用于各种操作的对象识别 |
| layerId   | String | 模型所属的图层Id，Id可以通过getModelsByType接口获得。如果这个为空，会在场景世界中查找并且设置第一个对应Id和Ids的对象，如果不为空，只会查找指定layerId图层内的匹配Id和Ids的模型对象。 |

#### 回调数据

```json
{
  "result": 1,
  "message": "成功。",
  "id": "modelId",
  "data": [
    {
      "name": "animationName01",
      "speed": 1,
      "rerverserType": "none",
      "state": "stop"
    },
    {
      "name": "animationName01",
      "speed": 1,
      "rerverserType": "none",
      "state": "stop"
    }
  ]
}
```

#### 回调数据参数描述

| 属性                  | 类型   | 说明                                                                        |
| --------------------- | ------ | --------------------------------------------------------------------------- |
| result                | Number | 1：代表成功；0：代表失败                                                    |
| message               | String | 成功或者失败原因                                                            |
| id                    | String | 返回当前模型包含的全部动画                                                  |
| data                  | Array  | 获取模型动画数据                                                            |
| data[0].name          | String | 动画名称                                                                    |
| data[0].speed         | Number | 动画播放倍速                                                                |
| data[0].rerverserType | String | 动画是否自动反播循环，"none"：不循环, "round"：单向循环, "repeat"：往返循环 |
| data[0].state         | Number | 当前动画状态，"stop"，"playing", "pause"                                    |

[返回本章目录](#目录)

## 4.设置模型动画

### 功能描述

设置模型动画

### 调用方法

```js
let jsonData = {
  id: "modelId",
  layerId: "layerId",
  name: "animationName01",
  speed: 1,
  rerverserType: "none",
}


appInstance.uniCall('setModelAnimation', jsonData, (result) => {
  console.log(result);
});
```

#### 参数描述

| 属性          | 类型   | 说明                                                                        |
| ------------- | ------ | --------------------------------------------------------------------------- |
| id            | String | 模型对象 id，新建时调用者自己传入的唯一标识，用于各种操作的对象识别         |
| layerId            | String | 模型所属的图层Id，Id可以通过getModelsByType接口获得。如果这个为空，会在场景世界中查找并且设置第一个对应Id和Ids的对象，如果不为空，只会查找指定layerId图层内的匹配Id和Ids的模型对象。         |
| name          | String | 不可修改，用于查找模型中需要修改的动画                                      |
| speed         | Number | 动画播放倍速                                                                |
| rerverserType | String | 动画是否自动反播循环，"none"：不循环, "round"：单向循环, "repeat"：往返循环 |

#### 回调数据

```json
{
  "result": 1,
  "message": "成功。"
}
```

#### 回调数据参数描述

| 属性    | 类型   | 说明                     |
| ------- | ------ | ------------------------ |
| result  | Number | 1：代表成功；0：代表失败 |
| message | String | 成功或者失败原因         |

[返回本章目录](#目录)

## 5.播放模型动画

### 功能描述

播放模型动画

### 调用方法

```js
let jsonData = {
  id: 'modelId',
  layerId: "layerId",
  name: 'animationName01',
  state: 'pause',
};

appInstance.uniCall('playModelAnimation', jsonData, (result) => {
  console.log(result);
});
```

#### 参数描述

| 属性  | 类型   | 说明                                                                |
| ----- | ------ | ------------------------------------------------------------------- |
| id    | String | 模型对象 id，新建时调用者自己传入的唯一标识，用于各种操作的对象识别 |
| layerId    | String | 模型所属的图层Id，Id可以通过getModelsByType接口获得。如果这个为空，会在场景世界中查找并且设置第一个对应Id和Ids的对象，如果不为空，只会查找指定layerId图层内的匹配Id和Ids的模型对象。 |
| name  | String | 不可修改，用于查找模型中需要修改的动画                              |
| state | String | 状态是： "begin", "pause", "stop", "restart" 四种                   |

[返回本章目录](#目录)

## 6.开始关节变换

### 功能描述

开始关节变换

### 调用方法

```js
appInstance.uniCall(
  'addEventListener',
  {
    eventName: 'onArticulationStart',
    callback: function(event) {
      console.log(event);
    },
  },
  (result) => {
    console.log(result);
  }
);
```

#### 回调数据

```json
{   
  "id": "articulationName01"
}

```

#### 回调数据参数描述

| 属性 | 类型   | 说明    |
| ---- | ------ | ------- |
| id   | String | 模型对象 id，新建时调用者自己传入的唯一标识，用于各种操作的对象识别 |

[返回本章目录](#目录)

## 7.结束关节变换

### 功能描述

结束关节变换

### 调用方法

```js
appInstance.uniCall(
  'addEventListener',
  {
    eventName: 'onArticulationEnd',
    callback: function(event) {
      console.log(event);
    },
  },
  (result) => {
    console.log(result);
  }
);
```

#### 回调数据

```json
{   
  "id": "articulationName01"
}

```

#### 回调数据参数描述

| 属性 | 类型   | 说明    |
| ---- | ------ | ------- |
| id   | String | 模型对象 id，新建时调用者自己传入的唯一标识，用于各种操作的对象识别 |

[返回本章目录](#目录)

## 8.开始播放动画

### 功能描述

开始播放动画

### 调用方法

```js
appInstance.uniCall(
  'addEventListener',
  {
    eventName: 'onAnimationStart',
    callback: function(event) {
      console.log(event);
    },
  },
  (result) => {
    console.log(result);
  }
);
```

#### 回调数据

```json
{   
  "id": "articulationName01"
}

```

#### 回调数据参数描述

| 属性 | 类型   | 说明    |
| ---- | ------ | ------- |
| id   | String | 模型对象 id，新建时调用者自己传入的唯一标识，用于各种操作的对象识别 |

[返回本章目录](#目录)

## 9.结束播放动画

### 功能描述

结束播放动画

### 调用方法

```js
appInstance.uniCall(
  'addEventListener',
  {
    eventName: 'onAnimationEnd',
    callback: function(event) {
      console.log(event);
    },
  },
  (result) => {
    console.log(result);
  }
);
```

#### 回调数据

```json
{   
  "id": "articulationName01"
}

```

#### 回调数据参数描述

| 属性 | 类型   | 说明    |
| ---- | ------ | ------- |
| id   | String | 模型对象 id，新建时调用者自己传入的唯一标识，用于各种操作的对象识别 |

[返回本章目录](#目录)
