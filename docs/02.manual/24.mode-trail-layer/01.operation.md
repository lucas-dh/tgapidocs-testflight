# 模型轨迹图操作

## 目录

- [1.添加模型轨迹图](#1添加模型轨迹图)
- [2.更新模型轨迹图数据](#2更新模型轨迹图数据)
- [3.更新模型轨迹图样式](#3更新模型轨迹图样式)
- [4.删除模型轨迹图](#4删除模型轨迹图)

## 1.添加模型轨迹图

### 功能描述

在三维场景中添加模型轨迹图

### 调用方法

```js
let jsonData = {
  id: 'modelTrailLayerId', // 图层对象 id，新建时调用者自己传入的唯一标识，用于各种操作的对象识别
  name: 'layerName', // 图层名称，支持为图层自定义名称
  coordType: 0, // XY 轴坐标类别，0：X 经度，Y 纬度；1：X 米，Y米，相对世界00点
  coordTypeZ: 0, // Z 轴坐标类别，0：相对 3D 世界 0 海拔；1：相对 3D 世界地表；2：相对 3D 模型表面（单位：米）
  snapSurface: 0, // 启用自动贴地。0：不贴地；1：贴地
  duration: 1.5, // 从上一位置运动到新位置花费的时间（单位：秒），如果启用modelTrailData数据服务，同时表示同步数据的时间周期
  modelMaxDistance: 5000, // 模型最大可见距离（单位：米），不可见后显示icon
  iconMaxDistance: 100000, // icon最大可见距离（单位：米），不可见后隐藏
  isAutoRotation: false, // 是否自动根据当前位置和上一位置计算运动方向，如果为true的话，data中的rotation将不起作用。
  trackStyle: "style001",	// 尾迹风格，端：style001，流：particle-粒子效果，vector-矢量线效果，belt：条带效果，none-无
  trackDuration: 20, // 尾迹粒子生命周期
  trackWidth: 50, // 尾迹粒子的宽度
  trackVisible: 'ShowAll', // 尾迹显示状态，"ShowAll"：显示所有对象尾迹，"HideAll"：隐藏所有对象尾迹，"对象Id"：只显示当前图层特定对象Id的尾迹
  objLife: 60, // 批号消批时间长度
  modelTrailDataId: '', // 对应本服务器上modelTrail数据Id，如果找到id，则下方的data不起作用
  isReferenceType: false, // 模型是引用类型还是复制类型，引用类型的对象占用更少的显存和绘制调用次数，但是端渲染无法自定义修改材质和粒子效果，且不支持设置单个实例的透明度，流渲染不支持关节和动画。默认是复制类型。false: 复制类型，true: 引用类型。
  tags: ["tag1", "tag2", "tag3"],	// 用户自定标签数组，用于保存用户的扩展数据，或者可以控制显隐
  visible: true, // 添加当前图层时默认显示还是隐藏
  modelSource: "local"	// 模型类型的位置，"local"：场景内，"localFile"：场景目录里customModel，"localServer"：流渲染服务器资产目录，“dataServer”：场景数据服务器资产（需要先使用connectDataServer成功连接到场景数据服务器）
  legends: [
    {
      name: 'legendName1', // 图层内图例名称，新建时调用者自己传入的唯一名称，用于各种操作的图例识别
      modelType: 'Car01', // 模型类型
      scale: 1, // 整体放缩倍数（单位：倍）
      iconName: 'bus', // 内置图标名称，详见下表：内置图标；或根据项目，在场景中预置好的图标对象的名称，包含文字样式定义
      trackColor: '#ff0000', // 尾迹颜色
      trackBottomColor: "#00ff00",	// 尾迹反面颜色，当trackStyle: "belt"时生效
      labelColor: '#ff0000', // 标签文本颜色，可选值，默认白色
      labelScale: 1, // 标签文本的缩放，默认值是1表示原大，0 - 1：表示缩小倍率，大于1：表示放大倍率
      labelOffset: [0, 0, 2], // 标签文本的位置偏移，默认值是[0, 0, 0]，表示相对于模型中心点的x、y、z偏移位置（单位：米）
      labelBackgroundColor: '#333333', // 标签文本背景颜色，可选值，默认灰色
    },
    {
      name: 'legendName2',
      modelType: 'Car02',
      scale: 0.75,
      iconName: 'car',
      trackColor: '#ff0000', // 尾迹颜色
      trackBottomColor: "#00ff00",
      labelColor: '#ff0000',
      labelScale: 1,
      labelOffset: [0, 0, 2],
      labelBackgroundColor: '#333333',
    },
  ],
  data: [
    // 定义图层可视化数据
    {
      id: '1', // 图层子对象 id，新建时调用者自己传入的唯一标识，用于各种操作的对象识别
      label: '小汽车1', // 标签文本
      coord: [0.0036397165615085214, 0.0001274129970099125], // XY 轴坐标，X：经度；Y：纬度
      coordZ: 10, // Z 轴高度（单位：米）
      rotation: [0, 180, 0], // XYZ 三轴旋转度数 [偏航角（单位：角度，0正北, -360~360), 俯仰角（单位：角度，0水平, -360~360),翻滚角（单位：角度，0水平, -360~360)]
      type: 'legendName1', // 模型图例类别
    },
    {
      id: '2', // 图层子对象 id，新建时调用者自己传入的唯一标识，用于各种操作的对象识别
      label: '卡车1', // 标签文本
      coord: [0.0026397165615037466, 0.0001274129970099125], // XY 轴坐标，X：经度；Y：纬度
      coordZ: 10, // Z 轴高度（单位：米）
      rotation: [0, 180, 0], // XYZ 三轴旋转度数 [偏航角（单位：角度，0正北, -360~360), 俯仰角（单位：角度，0水平, -360~360),翻滚角（单位：角度，0水平, -360~360)]
      type: 'legendName2', // 模型图例类别
    },
    {
      id: '3', // 图层子对象 id，新建时调用者自己传入的唯一标识，用于各种操作的对象识别
      label: '小汽车2', // 标签文本
      coord: [0.0016397165614989717, 0.0001274129970099125], // XY 轴坐标，X：经度；Y：纬度
      coordZ: 10, // Z 轴高度（单位：米）
      rotation: [0, 180, 0], // XYZ 三轴旋转度数 [偏航角（单位：角度，0正北, -360~360), 俯仰角（单位：角度，0水平, -360~360),翻滚角（单位：角度，0水平, -360~360)]
      type: 'legendName1', // 模型图例类别
    },
  ],
  tleData: [
    // 定义图层可视化TLE（双行根数）数据，根据TLE和场景时间，计算目标在地惯系下的位置
    {
        id: "objId", // 图层子对象 id，新建时调用者自己传入的唯一标识，用于各种操作的对象识别
        label: "poi title", // 标签文本
        line1: "1 60379U 24140A   25001.32435384  .00000109  00000+0  14768-3 0  9994",
        line2: "2 60379  88.9883 334.8035 0019127 129.0921 231.1935 13.51870555 20715",
        rotation: [20,80,90],
        type: "legendName1" // 模型型号图例类别
    },
    {
        id: "objId",
        label: "poi title",
        line1: "1 60380U 24140B   25001.79631721  .00000189  00000+0  27440-3 0  9999",
        line2: "2 60380  88.9874 334.6407 0014715 101.6272 258.6532 13.50905401 20839",
        rotation: [20,80,90],
        type: "legendName2"
    }
  ]
};

appInstance.uniCall('addModelTrailLayer', jsonData, (result) => {
  console.log(result);
});
```

#### 参数描述

| 属性                            | 类型    | 说明                                                                                                                                                                                                                                                                                                     | 端渲染 | 流渲染 |
| ------------------------------- | ------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------ | ------ |
| id                              | String  | 图层对象 id，新建时调用者自己传入的唯一标识，用于各种操作的对象识                                                                                                                                                                                                                                        | 支持   | 支持   |
| name                            | String  | 图层名称，支持为图层自定义名称                                                                                                                                                                                                                                                                           | 支持   | 支持   |
| coordType                       | Number  | XY 轴坐标类别，0：X 经度，Y 纬度；1：X 米，Y 米，相对世界 00 点                                                                                                                                                                                                                                          | 支持   | 支持   |
| coordTypeZ                      | Number  | Z 轴坐标类别，0：相对 3D 世界 0 海拔；1：相对 3D 世界地表；2：相对 3D 模型表面（单位：米）                                                                                                                                                                                                               | 支持   | 支持   |
| snapSurface                     | String  | 启用自动贴地。0：不贴地；1：贴地识                                                                                                                                                                                                                                                                       | 支持   | 支持   |
| duration                        | Number  | 从上一位置运动到新位置花费的时间（单位：秒），如果启用 modelTrailData 数据服务，同时表示同步数据的时间周期                                                                                                                                                                                               | 支持   | 支持   |
| modelMaxDistance                | Number  | 模型最大可见距离（单位：米），不可见后显示 icon                                                                                                                                                                                                                                                          | 支持   | 支持   |
| iconMaxDistance                 | Number  | icon 最大可见距离（单位：米），不可见后隐藏                                                                                                                                                                                                                                                              | 支持   | 支持   |
| isAutoRotation                  | Boolean | 是否自动根据当前位置和上一位置计算运动方向，如果为 true 的话，data 中的 rotation 将不起作用                                                                                                                                                                                                              | 支持   | 支持   |
| trackStyle                      | String  | 尾迹风格，端：style001，流：particle-粒子效果，vector-矢量线效果，belt-条带效果，none-无                                                                                                                                                                                                                 | 支持   | 支持   |
| trackDuration                   | Number  | 尾迹粒子生命周期                                                                                                                                                                                                                                                                                         | 支持   | 支持   |
| trackWidth                      | Number  | 尾迹粒子的宽度                                                                                                                                                                                                                                                                                           | 支持   | 支持   |
| trackVisible                    | String  | 尾迹显示状态，"ShowAll"：显示所有对象尾迹，"HideAll"：隐藏所有对象尾迹，"对象 Id"：只显示当前图层特定对象 Id 的尾迹                                                                                                                                                                                      | 支持   | 支持   |
| objLife                         | Number  | 批号消批时间长度                                                                                                                                                                                                                                                                                         | 支持   | 支持   |
| modelTrailDataId                | String  | 对应本服务器上 modelTrail 数据 Id，如果找到 id，则下方的 data 不起作用期                                                                                                                                                                                                                                 | 支持   | 支持   |
| isReferenceType                 | Boolean | 模型是引用类型还是复制类型，引用类型的对象占用更少的显存和绘制调用次数，但是端渲染无法自定义修改材质和粒子效果，且不支持设置单个实例的透明度，流渲染不支持关节和动画。默认是引用类型。false: 复制类型，true: 引用类型。                                                                                  | 支持   | 支持   |
| tags                            | Array   | 用户自定标签数组，用于保存用户的扩展数据，或者可以控制显隐                                                                                                                                                                                                                                               | 不支持 | 支持   |
| visible                         | Boolean | 添加当前图层时默认显示还是隐藏                                                                                                                                                                                                                                                                           | 支持   | 支持   |
| modelSource                     | String  | 模型类型的位置，"local"：场景内，"localFile"：场景目录里 customModel，"localServer"：流渲染服务器资产目录，"dataServer"：场景数据服务器资产（需要先使用 connectDataServer 成功连接到场景数据服务器）                                                                                                     | 支持   | 支持   |
| legends                         | Array   | 定义图层包含图例，支持为不同图例定义各自样式                                                                                                                                                                                                                                                             | 支持   | 支持   |
| legends[0].name                 | String  | 图层内图例名称，新建时调用者自己传入的唯一名称，用于各种操作的图例识别                                                                                                                                                                                                                                   | 支持   | 支持   |
| legends[0].modelType            | String  | model（模型），building（建筑物），connection（关系线），iconModel（模型型号）                                                                                                                                                                                                                           | 支持   | 支持   |
| legends[0].scale                | Number  | 整体放缩倍数（单位：倍）                                                                                                                                                                                                                                                                                 | 支持   | 支持   |
| legends[0].iconName             | String  | 内置图标名称，或根据项目，在场景中预置好的图标对象的名称，包含文字样式定义，具体图标名称参考下表和下图                                                                                                                                                                                                   | 支持   | 支持   |
| legends[0].trackColor           | String  | 尾迹颜色                                                                                                                                                                                                                                                                                                 | 支持   | 支持   |
| legends[0].trackBottomColor     | String  | 尾迹反面颜色，当 trackStyle: "belt"时生效                                                                                                                                                                                                                                                                | 不支持 | 支持   |
| legends[0].labelColor           | String  | 标签文本颜色，可选值，默认白色                                                                                                                                                                                                                                                                           | 支持   | 支持   |
| legends[0].labelScale           | Number  | 标签文本的缩放，默认值是 1 表示原大，0 - 1：表示缩小倍率，大于 1：表示放大倍率                                                                                                                                                                                                                           | 支持   | 支持   |
| legends[0].labelOffset          | Array   | 标签文本的位置偏移，默认值是[0, 0, 0]，表示相对于模型中心点的 x、y、z 偏移位置（单位：米）                                                                                                                                                                                                               | 支持   | 支持   |
| legends[0].labelBackgroundColor | String  | 标签文本背景颜色，可选值，默认灰色                                                                                                                                                                                                                                                                       | 支持   | 支持   |
| data                            | Array   | 定义图层可视化数据                                                                                                                                                                                                                                                                                       | 支持   | 支持   |
| data[0].id                      | String  | 图层子对象 id，新建时调用者自己传入的唯一标识，用于各种操作的对象识别                                                                                                                                                                                                                                    | 支持   | 支持   |
| data[0].label                   | String  | 标签文本                                                                                                                                                                                                                                                                                                 | 支持   | 支持   |
| data[0].coord                   | Array   | XY 轴坐标，X：经度；Y：纬度                                                                                                                                                                                                                                                                              | 支持   | 支持   |
| data[0].coordZ                  | Number  | Z 轴高度（单位：米）                                                                                                                                                                                                                                                                                     | 支持   | 支持   |
| data[0].rotation                | Array   | [Yaw、Pitch、Roll] Yaw 偏航（单位：角度，正南为 0 度，以天为正方向的左手法则, 值域：-360 到 360），Pitch 俯仰角（单位：角度，水平面模型前进方向为 0 度，前进方向左侧的左手法则, 值域：-360 到 360），Roll 翻滚角（单位：角度，水平面模型前进方向右侧为 0 度，模型前进方向的左手法则, 值域：-360 到 360） | 支持   | 支持   |
| data[0].type                    | String  | 模型图例类别                                                                                                                                                                                                                                                                                             | 支持   | 支持   |
| tleData                         | Array   | 定义图层可视化 TLE（双行根数）数据，根据 TLE 和场景时间，计算目标在地惯系下的位置                                                                                                                                                                                                                        | 支持   | 支持   |
| tleData[0].id                   | String  | 图层子对象 id，新建时调用者自己传入的唯一标识，用于各种操作的对象识别                                                                                                                                                                                                                                    | 支持   | 支持   |
| tleData[0].label                | String  | 标签文本                                                                                                                                                                                                                                                                                                 | 支持   | 支持   |
| tleData[0].line1                | String  | 双行根数第一行，注意空格和符号，格式必须是："1 NNNNNU NNNNNAAA NNNNN.NNNNNNNN +.NNNNNNNN +NNNNN-N +NNNNN-N N NNNNN"                                                                                                                                                                                      | 支持   | 支持   |
| tleData[0].line2                | String  | 双行根数第一行，注意空格和符号，格式必须是："2 NNNNN NNN.NNNN NNN.NNNN NNNNNNN NNN.NNNN NNN.NNNN NN.NNNNNNNNNNNNNN"                                                                                                                                                                                      | 支持   | 支持   |
| tleData[0].rotation             | String  | [Yaw、Pitch、Roll] Yaw 偏航（单位：角度，正南为 0 度，以天为正方向的左手法则, 值域：-360 到 360)，Pitch 俯仰角（单位：角度，水平面模型前进方向为 0 度，前进方向左侧的左手法则, 值域：-360 到 360)，Roll 翻滚角（单位：角度，水平面模型前进方向右侧为 0 度，模型前进方向的左手法则, 值域：-360 到 360)    | 支持   | 支持   |
| tleData[0].type                 | String  | 模型型号图例类别                                                                                                                                                                                                                                                                                         | 支持   | 支持   |

### 回调数据

```json
{
  "result": 1,
  "message": "成功。"
}
```

### 回调数据参数描述

| 属性    | 类型   | 说明                     |
| ------- | ------ | ------------------------ |
| result  | Number | 1：代表成功；0：代表失败 |
| message | String | 成功或者失败原因         |

### 具体内置图标名称（iconName）详情

<table>
    <tr>
      <th>图标类型</th>
      <th>图标名称</th>
    </tr>
    <tr>
      <td rowspan="15" style="text-align:left;">市政设施</td>
      <td>camera</td>
    </tr>
    <tr>
      <td>streetlamp</td>
    </tr>
    <tr>
      <td>manholecover</td>
    </tr>
    <tr>
      <td>sensor</td>
    </tr>
    <tr>
      <td>utilitypole</td>
    </tr>
    <tr>
      <td>transmission</td>
    </tr>
    <tr>
      <td>broadcast</td>
    </tr>
    <tr>
      <td>wifi</td>
    </tr>
    <tr>
      <td>firehydrant</td>
    </tr>
    <tr>
      <td>equipmentbox</td>
    </tr>
    <tr>
      <td>trafficlight</td>
    </tr>
    <tr>
      <td>charge</td>
    </tr>
    <tr>
      <td>gasstation</td>
    </tr>
    <tr>
      <td>wc</td>
    </tr>
    <tr>
      <td>dustbin</td>
    </tr>
    <tr>
      <td rowspan="20" style="text-align:left;">地点建筑</td>
      <td>trainstation</td>
    </tr>
    <tr>
      <td>airport</td>
    </tr>
    <tr>
      <td>anchor</td>
    </tr>
    <tr>
      <td>government</td>
    </tr>
    <tr>
      <td>netpoint</td>
    </tr>
    <tr>
      <td>metro</td>
    </tr>
    <tr>
      <td>finance</td>
    </tr>
    <tr>
      <td>school</td>
    </tr>
    <tr>
      <td>hospital</td>
    </tr>
    <tr>
      <td>factory</td>
    </tr>
    <tr>
      <td>constructionsite</td>
    </tr>
    <tr>
      <td>residence</td>
    </tr>
    <tr>
      <td>mergencyshelter</td>
    </tr>
    <tr>
      <td>park</td>
    </tr>
    <tr>
      <td>diningroom</td>
    </tr>
    <tr>
      <td>warehouse</td>
    </tr>
    <tr>
      <td>store</td>
    </tr>
    <tr>
      <td>tollgate</td>
    </tr>
    <tr>
      <td>officebuilding</td>
    </tr>
    <tr>
      <td>busstation</td>
    </tr>
    <tr>
      <td rowspan="5" style="text-align:left;">人员</td>
      <td>people</td>
    </tr>
    <tr>
      <td>policeman</td>
    </tr>
    <tr>
      <td>doctor</td>
    </tr>
    <tr>
      <td>specialpeople</td>
    </tr>
    <tr>
      <td>criminal</td>
    </tr>
    <tr>
      <td rowspan="15" style="text-align:left;">交通</td>
      <td>car</td>
    </tr>
    <tr>
      <td>policecar</td>
    </tr>
    <tr>
      <td>fireengine</td>
    </tr>
    <tr>
      <td>ambulance</td>
    </tr>
    <tr>
      <td>taxi</td>
    </tr>
    <tr>
      <td>truck</td>
    </tr>
    <tr>
      <td>bus</td>
    </tr>
    <tr>
      <td>newscar</td>
    </tr>
    <tr>
      <td>militarycar</td>
    </tr>
    <tr>
      <td>municipal</td>
    </tr>
    <tr>
      <td>electriccar</td>
    </tr>
    <tr>
      <td>watercar</td>
    </tr>
    <tr>
      <td>train</td>
    </tr>
    <tr>
      <td>ship</td>
    </tr>
    <tr>
      <td>cargoship</td>
    </tr>
    <tr>
      <td rowspan="5" style="text-align:left;">飞行器</td>
      <td>airplane</td>
    </tr>
    <tr>
      <td>helicopter</td>
    </tr>
    <tr>
      <td>uav</td>
    </tr>
    <tr>
      <td>satellite</td>
    </tr>
    <tr>
      <td>rocket</td>
    </tr>
    <tr>
      <td rowspan="3" style="text-align:left;">事件</td>
      <td>event_01</td>
    </tr>
    <tr>
      <td>event_03</td>
    </tr>
    <tr>
      <td>event_03</td>
    </tr>
    <tr>
      <td rowspan="4" style="text-align:left;">通用</td>
      <td>icon_01</td>
    </tr>
    <tr>
      <td>icon_02</td>
    </tr>
    <tr>
      <td>icon_03</td>
    </tr>
    <tr>
      <td>icon_04</td>
    </tr>
    <tr>
      <td rowspan="3" style="text-align:left;">地名</td>
      <td>site_01</td>
    </tr>
    <tr>
      <td>site_02</td>
    </tr>
    <tr>
      <td>site_03</td>
    </tr>
</table>

### 具体内置图标名称（iconName）效果

<img src="./contents/mediaFiles/images/iconName.jpg" width = "1344" height = "765" alt="图标效果" />

[返回本章目录](#目录)

## 2.更新模型轨迹图数据

### 功能描述

更新三维场景中添加模型轨迹图的数据

### 调用方法

```js
let jsonData = [
  {
    id: 'modelTrailLayerId',
    name: 'layerName',
    coordType: 0,
    coordTypeZ: 0,
    isAppend: true,
    duration: 3,
    tags: ['tag1', 'tag2', 'tag3'],
    data: [
      {
        id: '1',
        coord: [0.0036397165615085214, 0.008127412997009031],
        coordZ: 5,
        label: '小汽车1',
        rotation: [0, 180, 0],
        type: 'legendName1',
      },
      {
        id: '2',
        coord: [0.0026397165615037466, 0.00612741299701014],
        coordZ: 5,
        label: '卡车1',
        rotation: [0, 180, 0],
        type: 'legendName2',
      },
      {
        id: '3',
        coord: [0.0016397165615131826, 0.004127412997007696],
        coordZ: 5,
        label: '小汽车2',
        rotation: [0, 180, 0],
        type: 'legendName1',
      },
    ],
    tleData: [
      {
        id: 'objId',
        label: 'poi title',
        line1: '1 60379U 24140A   25001.32435384  .00000109  00000+0  14768-3 0  9994',
        line2: '2 60379  88.9883 334.8035 0019127 129.0921 231.1935 13.51870555 20715',
        rotation: [20, 80, 90],
        type: 'legendName1',
      },
      {
        id: 'objId',
        label: 'poi title',
        line1: '1 60380U 24140B   25001.79631721  .00000189  00000+0  27440-3 0  9999',
        line2: '2 60380  88.9874 334.6407 0014715 101.6272 258.6532 13.50905401 20839',
        rotation: [20, 80, 90],
        type: 'legendName2',
      },
    ],
  },
  {
    id: 'modelTrailLayerId',
    name: 'layerName',
    coordType: 0,
    coordTypeZ: 0,
    isAppend: true,
    duration: 3,
    data: [
      {
        id: '1',
        coord: [-0.00536028343849182, 0.008127412997009031],
        coordZ: 5,
        label: '小汽车',
        rotation: [0, -90, 0],
        type: 'legendName1',
      },
      {
        id: '2',
        coord: [-0.00536028343849182, 0.00612741299701014],
        coordZ: 5,
        label: '卡车1',
        rotation: [0, -90, 0],
        type: 'legendName2',
      },
      {
        id: '3',
        coord: [-0.00536028343849182, 0.004127412997007696],
        coordZ: 5,
        label: '小汽车2',
        rotation: [0, -90, 0],
        type: 'legendName1',
      },
    ],
    tleData: [
      {
        id: 'objId',
        label: 'poi title',
        line1: '1 60379U 24140A   25001.32435384  .00000109  00000+0  14768-3 0  9994',
        line2: '2 60379  88.9883 334.8035 0019127 129.0921 231.1935 13.51870555 20715',
        rotation: [20, 80, 90],
        type: 'legendName1',
      },
      {
        id: 'objId',
        label: 'poi title',
        line1: '1 60380U 24140B   25001.79631721  .00000189  00000+0  27440-3 0  9999',
        line2: '2 60380  88.9874 334.6407 0014715 101.6272 258.6532 13.50905401 20839',
        rotation: [20, 80, 90],
        type: 'legendName2',
      },
    ],
  },
  {
    id: 'modelTrailLayerId',
    name: 'layerName',
    coordType: 0,
    coordTypeZ: 0,
    isAppend: true,
    duration: 3,
    data: [
      {
        id: '1',
        coord: [-0.010360283438487272, 0.008127412997009031],
        coordZ: 5,
        label: '小汽车1',
        rotation: [0, -90, 0],
        type: 'legendName1',
      },
      {
        id: '2',
        coord: [-0.009360283438496708, 0.00612741299701014],
        coordZ: 5,
        rotation: [0, -90, 0],
        label: '卡车1',
        type: 'legendName2',
      },
      {
        id: '3',
        coord: [-0.008360283438491933, 0.004127412997007696],
        coordZ: 5,
        rotation: [0, -90, 0],
        label: '小汽车2',
        type: 'legendName1',
      },
    ],
    tleData: [
      {
        id: 'objId',
        label: 'poi title',
        line1: '1 60379U 24140A   25001.32435384  .00000109  00000+0  14768-3 0  9994',
        line2: '2 60379  88.9883 334.8035 0019127 129.0921 231.1935 13.51870555 20715',
        rotation: [20, 80, 90],
        type: 'legendName1',
      },
      {
        id: 'objId',
        label: 'poi title',
        line1: '1 60380U 24140B   25001.79631721  .00000189  00000+0  27440-3 0  9999',
        line2: '2 60380  88.9874 334.6407 0014715 101.6272 258.6532 13.50905401 20839',
        rotation: [20, 80, 90],
        type: 'legendName2',
      },
    ],
  },
  {
    id: 'modelTrailLayerId',
    name: 'layerName',
    coordType: 0,
    coordTypeZ: 0,
    isAppend: true,
    duration: 3,
    data: [
      {
        id: '1',
        coord: [-0.010360283438487272, 0.0001274129970099125],
        coordZ: 5,
        label: '小汽车1',
        rotation: [0, 0, 0],
        type: 'legendName1',
      },
      {
        id: '2',
        coord: [-0.009360283438496708, 0.0001274129970099125],
        coordZ: 5,
        rotation: [0, 0, 0],
        label: '卡车1',
        type: 'legendName2',
      },
      {
        id: '3',
        coord: [-0.008360283438491933, 0.0001274129970099125],
        coordZ: 5,
        rotation: [0, 0, 0],
        label: '小汽车2',
        type: 'legendName1',
      },
    ],
    tleData: [
      {
        id: 'objId',
        label: 'poi title',
        line1: '1 60379U 24140A   25001.32435384  .00000109  00000+0  14768-3 0  9994',
        line2: '2 60379  88.9883 334.8035 0019127 129.0921 231.1935 13.51870555 20715',
        rotation: [20, 80, 90],
        type: 'legendName1',
      },
      {
        id: 'objId',
        label: 'poi title',
        line1: '1 60380U 24140B   25001.79631721  .00000189  00000+0  27440-3 0  9999',
        line2: '2 60380  88.9874 334.6407 0014715 101.6272 258.6532 13.50905401 20839',
        rotation: [20, 80, 90],
        type: 'legendName2',
      },
    ],
  },
  {
    id: 'modelTrailLayerId',
    name: 'layerName',
    coordType: 0,
    coordTypeZ: 0,
    isAppend: true,
    duration: 3,
    data: [
      {
        id: '1',
        coord: [-0.010360283438487272, -0.005872587002990315],
        coordZ: 5,
        label: '小汽车1',
        rotation: [0, 0, 0],
        type: 'legendName1',
      },
      {
        id: '2',
        coord: [-0.009360283438496708, -0.004872587002989093],
        coordZ: 5,
        rotation: [0, 0, 0],
        label: '卡车1',
        type: 'legendName2',
      },
      {
        id: '3',
        coord: [-0.008360283438491933, -0.0038725870029914233],
        coordZ: 5,
        rotation: [0, 0, 0],
        label: '小汽车2',
        type: 'legendName1',
      },
    ],
    tleData: [
      {
        id: 'objId',
        label: 'poi title',
        line1: '1 60379U 24140A   25001.32435384  .00000109  00000+0  14768-3 0  9994',
        line2: '2 60379  88.9883 334.8035 0019127 129.0921 231.1935 13.51870555 20715',
        rotation: [20, 80, 90],
        type: 'legendName1',
      },
      {
        id: 'objId',
        label: 'poi title',
        line1: '1 60380U 24140B   25001.79631721  .00000189  00000+0  27440-3 0  9999',
        line2: '2 60380  88.9874 334.6407 0014715 101.6272 258.6532 13.50905401 20839',
        rotation: [20, 80, 90],
        type: 'legendName2',
      },
    ],
  },
  {
    id: 'modelTrailLayerId',
    name: 'layerName',
    coordType: 0,
    coordTypeZ: 0,
    isAppend: true,
    duration: 3,
    data: [
      {
        id: '1',
        coord: [-0.003360283438496481, -0.005872587002990315],
        coordZ: 5,
        label: '小汽车1',
        rotation: [0, 90, 0],
        type: 'legendName1',
      },
      {
        id: '2',
        coord: [-0.003360283438496481, -0.004872587002989093],
        coordZ: 5,
        rotation: [0, 90, 0],
        label: '卡车1',
        type: 'legendName2',
      },
      {
        id: '3',
        coord: [-0.003360283438496481, -0.0038725870029914233],
        coordZ: 5,
        rotation: [0, 90, 0],
        label: '小汽车2',
        type: 'legendName1',
      },
    ],
    tleData: [
      {
        id: 'objId',
        label: 'poi title',
        line1: '1 60379U 24140A   25001.32435384  .00000109  00000+0  14768-3 0  9994',
        line2: '2 60379  88.9883 334.8035 0019127 129.0921 231.1935 13.51870555 20715',
        rotation: [20, 80, 90],
        type: 'legendName1',
      },
      {
        id: 'objId',
        label: 'poi title',
        line1: '1 60380U 24140B   25001.79631721  .00000189  00000+0  27440-3 0  9999',
        line2: '2 60380  88.9874 334.6407 0014715 101.6272 258.6532 13.50905401 20839',
        rotation: [20, 80, 90],
        type: 'legendName2',
      },
    ],
  },
  {
    id: 'modelTrailLayerId',
    name: 'layerName',
    coordType: 0,
    coordTypeZ: 0,
    isAppend: true,
    duration: 3,
    data: [
      {
        id: '1',
        coord: [0.0036397165615085214, -0.005872587002990315],
        coordZ: 5,
        label: '小汽车1',
        rotation: [0, 90, 0],
        type: 'legendName1',
      },
      {
        id: '2',
        coord: [0.0026397165615037466, -0.004872587002989093],
        coordZ: 5,
        rotation: [0, 90, 0],
        label: '卡车1',
        type: 'legendName2',
      },
      {
        id: '3',
        coord: [0.0016397165615131826, -0.0038725870029914233],
        coordZ: 5,
        rotation: [0, 90, 0],
        label: '小汽车2',
        type: 'legendName1',
      },
    ],
    tleData: [
      {
        id: 'objId',
        label: 'poi title',
        line1: '1 60379U 24140A   25001.32435384  .00000109  00000+0  14768-3 0  9994',
        line2: '2 60379  88.9883 334.8035 0019127 129.0921 231.1935 13.51870555 20715',
        rotation: [20, 80, 90],
        type: 'legendName1',
      },
      {
        id: 'objId',
        label: 'poi title',
        line1: '1 60380U 24140B   25001.79631721  .00000189  00000+0  27440-3 0  9999',
        line2: '2 60380  88.9874 334.6407 0014715 101.6272 258.6532 13.50905401 20839',
        rotation: [20, 80, 90],
        type: 'legendName2',
      },
    ],
  },
  {
    id: 'modelTrailLayerId',
    name: 'layerName',
    coordType: 0,
    coordTypeZ: 0,
    isAppend: true,
    duration: 3,
    data: [
      {
        id: '1',
        coord: [0.0036397165615085214, 0.0001274129970099125],
        coordZ: 5,
        label: '小汽车1',
        rotation: [0, -180, 0],
        type: 'legendName1',
      },
      {
        id: '2',
        coord: [0.0026397165615037466, 0.0001274129970099125],
        coordZ: 5,
        rotation: [0, -180, 0],
        label: '卡车1',
        type: 'legendName2',
      },
      {
        id: '3',
        coord: [0.0016397165615131826, 0.0001274129970099125],
        coordZ: 5,
        rotation: [0, -180, 0],
        label: '小汽车2',
        type: 'legendName1',
      },
    ],
    tleData: [
      {
        id: 'objId',
        label: 'poi title',
        line1: '1 60379U 24140A   25001.32435384  .00000109  00000+0  14768-3 0  9994',
        line2: '2 60379  88.9883 334.8035 0019127 129.0921 231.1935 13.51870555 20715',
        rotation: [20, 80, 90],
        type: 'legendName1',
      },
      {
        id: 'objId',
        label: 'poi title',
        line1: '1 60380U 24140B   25001.79631721  .00000189  00000+0  27440-3 0  9999',
        line2: '2 60380  88.9874 334.6407 0014715 101.6272 258.6532 13.50905401 20839',
        rotation: [20, 80, 90],
        type: 'legendName2',
      },
    ],
  },
];

for (let i = 0; i < jsonData.length; i++) {
  setTimeout(() => {
    appInstance.uniCall('updateModelTrailLayerCoord', jsonData[i], (result) => {
      console.log(result);
    });
  }, i * 999);
}
```

#### 参数描述

| 属性                | 类型    | 说明                                                                                                                                                                                                                                                                                                     | 端渲染 | 流渲染 |
| ------------------- | ------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------ | ------ |
| id                  | String  | 图层对象 id，新建时调用者自己传入的唯一标识，用于各种操作的对象识别                                                                                                                                                                                                                                      | 支持   | 支持   |
| name                | String  | 图层名称，支持为图层自定义名称                                                                                                                                                                                                                                                                           | 支持   | 支持   |
| coordType           | Number  | XY 轴坐标类别，0：X 经度，Y 纬度；1：X 米，Y 米，相对世界 00 点                                                                                                                                                                                                                                          | 支持   | 支持   |
| coordTypeZ          | Number  | Z 轴坐标类别，0：相对 3D 世界 0 海拔；1：相对 3D 世界地表；2：相对 3D 模型表面（单位：米）                                                                                                                                                                                                               | 支持   | 支持   |
| isAppend            | Boolean | 是否追加数据（按数据顺序），true：按新数据 更新原有重复数据 & 追加新数据；false：清除原有数据 & 重建新数据                                                                                                                                                                                               | 支持   | 支持   |
| duration            | Number  | 从上一位置运动到新位置花费的时间（单位：秒），如果启用 modelTrailData 数据服务，同时表示同步数据的时间周期                                                                                                                                                                                               | 支持   | 支持   |
| tags                | Array   | 用户自定标签数组，用于保存用户的扩展数据，或者可以控制显隐                                                                                                                                                                                                                                               | 不支持 | 支持   |
| data                | Array   | 定义图层可视化数据                                                                                                                                                                                                                                                                                       | 支持   | 支持   |
| data[0].id          | String  | 图层子对象 id，新建时调用者自己传入的唯一标识，用于各种操作的对象识别                                                                                                                                                                                                                                    | 支持   | 支持   |
| data[0].coord       | Array   | XY 轴坐标，X：经度；Y：纬度                                                                                                                                                                                                                                                                              | 支持   | 支持   |
| data[0].coordZ      | Number  | Z 轴高度（单位：米）                                                                                                                                                                                                                                                                                     | 支持   | 支持   |
| data[0].label       | String  | 标签文本                                                                                                                                                                                                                                                                                                 | 支持   | 支持   |
| data[0].rotation    | Array   | [Yaw、Pitch、Roll] Yaw 偏航（单位：角度，正南为 0 度，以天为正方向的左手法则, 值域：-360 到 360），Pitch 俯仰角（单位：角度，水平面模型前进方向为 0 度，前进方向左侧的左手法则, 值域：-360 到 360），Roll 翻滚角（单位：角度，水平面模型前进方向右侧为 0 度，模型前进方向的左手法则, 值域：-360 到 360） | 支持   | 支持   |
| data[0].type        | String  | 数据点图例类别                                                                                                                                                                                                                                                                                           | 支持   | 支持   |
| tleData             | Array   | 定义图层可视化 TLE（双行根数）数据，根据 TLE 和场景时间，计算目标在地惯系下的位置                                                                                                                                                                                                                        | 支持   | 支持   |
| tleData[0].id       | String  | 图层子对象 id，新建时调用者自己传入的唯一标识，用于各种操作的对象识别                                                                                                                                                                                                                                    | 支持   | 支持   |
| tleData[0].label    | String  | 标签文本                                                                                                                                                                                                                                                                                                 | 支持   | 支持   |
| tleData[0].line1    | String  | 双行根数第一行，注意空格和符号，格式必须是："1 NNNNNU NNNNNAAA NNNNN.NNNNNNNN +.NNNNNNNN +NNNNN-N +NNNNN-N N NNNNN"                                                                                                                                                                                      | 支持   | 支持   |
| tleData[0].line2    | String  | 双行根数第一行，注意空格和符号，格式必须是："2 NNNNN NNN.NNNN NNN.NNNN NNNNNNN NNN.NNNN NNN.NNNN NN.NNNNNNNNNNNNNN"                                                                                                                                                                                      | 支持   | 支持   |
| tleData[0].rotation | String  | [Yaw、Pitch、Roll] Yaw 偏航（单位：角度，正南为 0 度，以天为正方向的左手法则, 值域：-360 到 360)，Pitch 俯仰角（单位：角度，水平面模型前进方向为 0 度，前进方向左侧的左手法则, 值域：-360 到 360)，Roll 翻滚角（单位：角度，水平面模型前进方向右侧为 0 度，模型前进方向的左手法则, 值域：-360 到 360)    | 支持   | 支持   |
| tleData[0].type     | String  | 模型型号图例类别                                                                                                                                                                                                                                                                                         | 支持   | 支持   |

#### 回调数据

```json
{
  "result": 1,
  "message": "成功。"
}
```

#### 回调数据参数描述

| 属性    | 类型   | 说明                     |
| ------- | ------ | ------------------------ |
| result  | Number | 1：代表成功；0：代表失败 |
| message | String | 成功或者失败原因         |

[返回本章目录](#目录)

## 3.更新模型轨迹图样式

### 功能描述

更新三维场景中添加模型轨迹图的样式

### 调用方法

```js
let jsonData = {
  id: 'modelTrailLayerId', // 图层对象 id，新建时调用者自己传入的唯一标识，用于各种操作的对象识别
  objLife: 60, // 批号消批时间长度
  modelMaxDistance: 10000, // 模型最大可见距离（单位：米），不可见后显示icon
  iconMaxDistance: 20000, // icon最大可见距离（单位：米），不可见后隐藏
  isAutoRotation: false, // 是否自动根据当前位置和上一位置计算运动方向，如果为true的话，data中的rotation将不起作用。
  trackStyle: 'style001', // 尾迹风格，端：style001，流：particle-粒子效果，vector-矢量线效果，belt：条带效果，none-无
  trackDuration: 50, // 尾迹粒子生命周期
  trackWidth: 10, // 尾迹粒子的宽度
  trackVisible: 'ShowAll', // 尾迹显示状态，"ShowAll"：显示所有对象尾迹，"HideAll"：隐藏所有对象尾迹，"对象Id"：只显示当前图层特定对象Id的尾迹
  modelSource: "local"	// 模型类型的位置，"local"：场景内，"localFile"：场景目录里customModel，"localServer"：流渲染服务器资产目录，“dataServer”：场景数据服务器资产（需要先使用connectDataServer成功连接到场景数据服务器）
  legends: [
    {
      name: 'legendName1', // 图层内图例名称，新建时调用者自己传入的唯一名称，用于各种操作的图例识别
      modelType: 'Car02', // 模型类型
      scale: 0.75, // 整体放缩倍数（单位：倍）
      iconName: 'bus', // 内置图标名称，详见上表；或根据项目，在场景中预置好的图标对象的名称，包含文字样式定义
      trackColor: '#ff0000', // 尾迹颜色
      trackBottomColor: "#00ff00", // 尾迹反面颜色，当trackStyle: "belt"时生效
      labelColor: '#000000', // 标签文本颜色，可选值，默认白色
      labelScale: 1, // 标签文本的缩放，默认值是1表示原大，0 - 1：表示缩小倍率，大于1：表示放大倍率
      labelOffset: [0, 0, 2], // 标签文本的位置偏移，默认值是[0, 0, 0]，表示相对于模型中心点的x、y、z偏移位置（单位：米）
      labelBackgroundColor: '#ffff00', // 标签文本背景颜色，可选值，默认灰色
    },
    {
      name: 'legendName2', // 图层内图例名称，新建时调用者自己传入的唯一名称，用于各种操作的图例识别
      modelType: 'Car01', // 模型类型
      scale: 1, // 整体放缩倍数（单位：倍）
      iconName: 'taxi', // 内置图标名称，详见上表；或根据项目，在场景中预置好的图标对象的名称，包含文字样式定义
      trackColor: '#ff0000', // 尾迹颜色
      trackBottomColor: "#00ff00", // 尾迹反面颜色，当trackStyle: "belt"时生效
      labelColor: '#000000', // 标签文本颜色，可选值，默认白色
      labelScale: 1, // 标签文本的缩放，默认值是1表示原大，0 - 1：表示缩小倍率，大于1：表示放大倍率
      labelOffset: [0, 0, 2], // 标签文本的位置偏移，默认值是[0, 0, 0]，表示相对于模型中心点的x、y、z偏移位置（单位：米）
      labelBackgroundColor: '#ffff00', // 标签文本背景颜色，可选值，默认灰色
    },
  ],
};

appInstance.uniCall('updateModelTrailLayerStyle', jsonData, (result) => {
  console.log(result);
});
```

#### 参数描述

| 属性                            | 类型    | 说明                                                                                                                                                                                                 | 端渲染 | 流渲染 |
| ------------------------------- | ------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------ | ------ |
| id                              | String  | 图层对象 id，新建时调用者自己传入的唯一标识，用于各种操作的对象识别                                                                                                                                  | 支持   | 支持   |
| objLife                         | Number  | 批号消批时间长度                                                                                                                                                                                     | 支持   | 支持   |
| modelMaxDistance                | Number  | 模型最大可见距离（单位：米），不可见后显示 icon                                                                                                                                                      | 支持   | 支持   |
| iconMaxDistance                 | Number  | icon 最大可见距离（单位：米），不可见后隐藏                                                                                                                                                          | 支持   | 支持   |
| isAutoRotation                  | Boolean | 是否自动根据当前位置和上一位置计算运动方向，如果为 true 的话，data 中的 rotation 将不起作用。                                                                                                        | 支持   | 支持   |
| trackStyle                      | String  | 尾迹风格，端：style001，流：particle-粒子效果，vector-矢量线效果，belt-条带效果，none-无                                                                                                             | 支持   | 支持   |
| trackDuration                   | Number  | 尾迹粒子生命周期                                                                                                                                                                                     | 支持   | 支持   |
| trackWidth                      | Number  | 尾迹粒子的宽度                                                                                                                                                                                       | 支持   | 支持   |
| trackVisible                    | String  | 尾迹显示状态，"ShowAll"：显示所有对象尾迹，"HideAll"：隐藏所有对象尾迹，"对象 Id"：只显示当前图层特定对象 Id 的尾迹                                                                                  | 支持   | 支持   |
| modelSource                     | String  | 模型类型的位置，"local"：场景内，"localFile"：场景目录里 customModel，"localServer"：流渲染服务器资产目录，"dataServer"：场景数据服务器资产（需要先使用 connectDataServer 成功连接到场景数据服务器） | 支持   | 支持   |
| legends                         | Array   | 定义图层包含图例，支持为不同图例定义各自样式                                                                                                                                                         | 支持   | 支持   |
| legends[0].name                 | String  | 图层内图例名称，新建时调用者自己传入的唯一名称，用于各种操作的图例识别                                                                                                                               | 支持   | 支持   |
| legends[0].modelType            | String  | model（模型），building（建筑物），connection（关系线），iconModel（模型型号）                                                                                                                       | 支持   | 支持   |
| legends[0].scale                | Number  | 整体放缩倍数（单位：倍）                                                                                                                                                                             | 支持   | 支持   |
| legends[0].iconName             | String  | 内置图标名称，或根据项目，在场景中预置好的图标对象的名称，包含文字样式定义，具体图标名称参考上表和上图                                                                                               | 支持   | 支持   |
| legends[0].trackColor           | String  | 尾迹颜色                                                                                                                                                                                             | 支持   | 支持   |
| legends[0].trackBottomColor     | String  | 尾迹反面颜色，当 trackStyle: "belt"时生效                                                                                                                                                            | 不支持 | 支持   |
| legends[0].labelColor           | String  | 标签文本颜色，可选值，默认白色                                                                                                                                                                       | 支持   | 支持   |
| legends[0].labelScale           | Number  | 标签文本的缩放，默认值是 1 表示原大，0 - 1：表示缩小倍率，大于 1：表示放大倍率                                                                                                                       | 支持   | 支持   |
| legends[0].labelOffset          | Array   | 标签文本的位置偏移，默认值是[0, 0, 0]，表示相对于模型中心点的 x、y、z 偏移位置（单位：米）                                                                                                           | 支持   | 支持   |
| legends[0].labelBackgroundColor | String  | 标签文本背景颜色，可选值，默认灰色                                                                                                                                                                   | 支持   | 支持   |

#### 回调数据

```json
{
  "result": 1,
  "message": "成功。"
}
```

#### 回调数据参数描述

| 属性    | 类型   | 说明                     |
| ------- | ------ | ------------------------ |
| result  | Number | 1：代表成功；0：代表失败 |
| message | String | 成功或者失败原因         |

[返回本章目录](#目录)

## 4.删除模型轨迹图

### 功能描述

删除模型轨迹图

### 调用方法

```js
let jsonData = {
  id: 'modelTrailLayerId', // 图层对象 id，新建时调用者自己传入的唯一标识，用于各种操作的对象识别
  overlayType: 'modelTrailLayer', // 图层对象类别
};

appInstance.uniCall('removeOverlay', jsonData, (result) => {
  console.log(result);
});
```

#### 参数描述

| 属性        | 类型   | 说明                                                                |
| ----------- | ------ | ------------------------------------------------------------------- |
| id          | String | 图层对象 id，新建时调用者自己传入的唯一标识，用于各种操作的对象识别 |
| overlayType | String | 图层对象类别                                                        |

#### 回调数据

```json
{
  "result": 1,
  "message": "成功。"
}
```

#### 回调数据参数描述

| 属性    | 类型   | 说明                     |
| ------- | ------ | ------------------------ |
| result  | Number | 1：代表成功；0：代表失败 |
| message | String | 成功或者失败原因         |

### 流渲染效果图

<img src="./contents/mediaFiles/images/overlay/modelTrailLayer-streaming.png" width = "544" height="405" alt="系统架构图" />

### 端渲染效果图

<img src="./contents/mediaFiles/images/overlay/modelTrailLayer.png" width = "544" height="405" alt="系统架构图" />

[返回本章目录](#目录)
