# 热力图操作

## 目录

- [1.添加热力图](#1添加热力图)
- [2.更新热力图数据](#2更新热力图数据)
- [3.更新热力图样式](#3更新热力图样式)
- [4.删除热力图](#4删除热力图)

## 1.添加热力图

### 功能描述

在三维场景中添加热力图

### 调用方法

```js
let jsonData = {
  id: 'heat',
  name: '热力图',
  coordType: 0,
  coordTypeZ: 0,
  coordZ: 64,
  type: 'default',
  alpha: 1,
  colorMax: '#FF6000',
  colorMin: '#009acf',
  valueStep: [0, 0.05, 0.1, 0.4, 0.5, 1.0],
  stepColor: ['#FF0000', '#990000', '#993300', '#336600', '#009900', '#00FF00'],
  valueMax: 60,
  valueMin: 20,
  radius: 1,
  is3D: false,
  heightMax: 500,
  showMesh: false,
  autoLevel: false,
  visible: true,
  pointDataId: 'pointDataId',
  tags: ['tag1', 'tag2', 'tag3'],
  clipBounds: [
    { coord: [139.499135835, 35.335562482] },
    { coord: [139.499123127, 35.3355322123] },
    { coord: [139.4991286816, 35.3355305794] },
    { coord: [139.4990550941, 35.3353515653] },
    { coord: [139.4990491072, 35.3353527836] },
    { coord: [139.4990368814, 35.3353230279] },
  ],
  data: [
    {
      coord: [113.937048265504, 22.512225796075], //以深圳湾经纬度为例
      value: 49,
    },
    {
      coord: [113.93457480179201, 22.5105226953384],
      value: 68.2,
    },
    {
      coord: [113.93197005305201, 22.5119335028355],
      value: 20,
    },
    {
      coord: [113.933041722167, 22.511783543624098],
      value: 18.2,
    },
    {
      coord: [113.93182026913301, 22.5114187899078],
      value: 156,
    },
    {
      coord: [113.93289097756801, 22.5107728537956],
      value: 35,
    },
    {
      coord: [113.933726869793, 22.5113162791849],
      value: 43,
    },
    {
      coord: [113.933652019171, 22.5104934447991],
      value: 62,
    },
  ],
};

appInstance.uniCall('addHeatMapLayer', jsonData, (result) => {
  console.log(result);
});
```

#### 参数描述

| 属性                 | 类型    | 说明                                                                                                                                                                                  | 端渲染             | 流渲染 |
| -------------------- | ------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------ | ------ |
| id                   | String  | 图层对象 id，新建时调用者自己传入的唯一标识，用于各种操作的对象识别                                                                                                                   | 支持               | 支持   |
| name                 | String  | 图层名称，支持为图层自定义名称                                                                                                                                                        | 支持               | 支持   |
| coordType            | Number  | XY 轴坐标类别，0：X 经度，Y 纬度；1：X 米，Y 米，相对世界 00 点 目前该属性仅支持属性值为 0                                                                                            | 支持               | 支持   |
| coordTypeZ           | Number  | Z 轴坐标类别，0：相对 3D 世界 0 海拔；1：相对 3D 世界地表；2：相对 3D 模型表面（单位：米） 目前该属性仅支持属性值为 0                                                                 | 支持               | 支持   |
| coordZ               | Number  | 高度(单位:米)                                                                                                                                                                         | 支持               | 支持   |
| type                 | String  | 外观类型，default：标准热图；dot：点状热图；temperature：温度热图（反距离加权算法，颜色使用的是 valueStep 和 setpColor ，不支持 colorMin 和 colorMax）                                | 不支持 temperature | 支持   |
| alpha                | Number  | 透明度，0：完全透明；1：完全不透明                                                                                                                                                    | 支持               | 支持   |
| colorMax             | Number  | 最大值上限颜色（HEX 颜色值）                                                                                                                                                          | 支持               | 支持   |
| colorMin             | Number  | 最小值下限颜色（HEX 颜色值）                                                                                                                                                          | 支持               | 支持   |
| valueStep            | Number  | 热图颜色渐变分段，valueMin 数值对应 0，valueMax 为 1.0，其中可以添加任意个比例分段。非必选参数，当 valueStep、stepColor、valueMax、valueMin 不为空时，colorMax 和 colorMin 不起作用。 | 支持               | 支持   |
| stepColor            | Number  | 热图颜色渐变分段，根据 valueStep 分段后段渐变的颜色                                                                                                                                   | 支持               | 支持   |
| valueMax             | Number  | 最大值上限                                                                                                                                                                            | 支持               | 支持   |
| valueMin             | Number  | 最小值下限                                                                                                                                                                            | 支持               | 支持   |
| is3D                 | Boolean | 是否三维柱图，true: 是三维柱图，false: 不是。默认不是。                                                                                                                               | 不支持             | 支持   |
| heightMax            | Number  | 三维柱的最大高度(单位: 米)                                                                                                                                                            | 不支持             | 支持   |
| showMesh             | Boolean | 三维柱图的样式，true: 显示面，false: 只显示网格体。默认: false                                                                                                                        | 不支持             | 支持   |
| radius               | Number  | 每一个点得半径单位（米）                                                                                                                                                              | 支持               | 支持   |
| autoLevel            | Boolean | 是否根据地图层级自动刷新热图效果，有聚合的效果。false：不自动刷新；true：自动刷新                                                                                                     | 支持               | 不支持 |
| visible              | Boolean | 添加当前图层时默认显示还是隐藏                                                                                                                                                        | 支持               | 支持   |
| pointDataId          | String  | 对应本服务器上点数据对象，如果找到 pointDataId，则下方的 data 不起作用（注意：此属性端渲染未生效）                                                                                    | 支持               | 支持   |
| tags                 | Array   | 用户自定标签数组，用于保存用户的扩展数据，或者可以控制显隐                                                                                                                            | 不支持             | 支持   |
| clipBounds           | Array   | 如果不为空，会按照以下点组成的闭合区域对热图进行剪裁。coord 是每个点的经纬度数据                                                                                                      | 不支持             | 支持   |
| data                 | Array   | 数据点位基本信息集合                                                                                                                                                                  | 支持               | 支持   |
| data[0].coord        | Number  | XY 轴坐标，X：经度；Y：纬度                                                                                                                                                           | 支持               | 支持   |
| data[0].value        | Number  | 数据点权值                                                                                                                                                                            | 支持               | 支持   |

#### 回调数据

```json
{
  "result": 1,
  "message": "成功。"
}
```

#### 回调数据参数描述

| 属性    | 类型   | 说明                     |
| ------- | ------ | ------------------------ |
| result  | Number | 1：代表成功；0：代表失败 |
| message | String | 成功或者失败原因         |

[返回本章目录](#目录)

## 2.更新热力图数据

### 功能描述

更新三维场景中添加热力图的数据

### 调用方法

```js
let addJsonData = {
  id: 'heat',
  name: '热力图',
  coordType: 0,
  coordTypeZ: 0,
  coordZ: 64,
  isAppend: true,
  tags: ['tag1', 'tag2', 'tag3'],
  data: [
    {
      coord: [113.885509506992, 22.502965897537702], //以深圳湾经纬度为例
      value: 49,
    },
    {
      coord: [113.885562502973, 22.501864834888902],
      value: 10,
    },
    {
      coord: [113.884877468344, 22.5015391845942],
      value: 80,
    },
    {
      coord: [113.884877516597, 22.500776211961103],
      value: 10,
    },
    {
      coord: [113.884651854979, 22.500281666137603],
      value: 18.2,
    },
    {
      coord: [113.886430222252, 22.5027650813156],
      value: 45,
    },
    {
      coord: [113.886377359799, 22.5017842236572],
      value: 60,
    },
    {
      coord: [113.886023886833, 22.5013789417393],
      value: 30,
    },
    {
      coord: [113.886891773299, 22.4993852764375],
      value: 182,
    },
  ],
};

appInstance.uniCall('updateHeatMapLayerCoord', addJsonData, (result) => {
  console.log(result);
});
```

#### 参数描述

| 属性          | 类型    | 说明                                                                                                                  | 端渲染 | 流渲染 |
| ------------- | ------- | --------------------------------------------------------------------------------------------------------------------- | ------ | ------ |
| id            | String  | 图层对象 id，新建时调用者自己传入的唯一标识，用于各种操作的对象识别                                                   | 支持   | 支持   |
| name          | String  | 图层名称，支持为图层自定义名称                                                                                        | 支持   | 支持   |
| coordType     | String  | XY 轴坐标类别，0：X 经度，Y 纬度；1：X 米，Y 米，相对世界 00 点 目前该属性仅支持属性值为 0                            | 支持   | 支持   |
| coordTypeZ    | Number  | Z 轴坐标类别，0：相对 3D 世界 0 海拔；1：相对 3D 世界地表；2：相对 3D 模型表面（单位：米） 目前该属性仅支持属性值为 0 | 支持   | 支持   |
| coordZ        | Number  | Z 轴高度（单位：米）                                                                                                  | 支持   | 支持   |
| isAppend      | Boolean | 是否追加数据（按数据顺序），true：在原有数据后方追加数据；false：清除原有数据，更新数据                               | 支持   | 支持   |
| tags          | Array   | 用户自定标签数组，用于保存用户的扩展数据，或者可以控制显隐                                                            | 不支持 | 支持   |
| data          | Array   | 数据点位基本信息集合                                                                                                  | 支持   | 支持   |
| data[0].coord | Array   | XY 轴坐标，X：经度；Y：纬度                                                                                           | 支持   | 支持   |
| data[0].value | Number  | 数据点权值                                                                                                            | 支持   | 支持   |

#### 回调数据

```json
{
  "result": 1,
  "message": "成功。"
}
```

#### 回调数据参数描述

| 属性    | 类型   | 说明                     |
| ------- | ------ | ------------------------ |
| result  | Number | 1：代表成功；0：代表失败 |
| message | String | 成功或者失败原因         |

[返回本章目录](#目录)

## 3.更新热力图样式

### 功能描述

更新三维场景中添加热力图的样式

### 调用方法

```js
let jsonData = {
  id: 'heat',
  type: 'dot',
  alpha: 0.8,
  colorMax: '#FFA64D',
  colorMin: '#D900D9',
  valueStep: [0, 0.05, 0.1, 0.4, 0.5, 1.0],
  stepColor: ['#FF0000', '#990000', '#993300', '#336600', '#009900', '#00FF00'],
  valueMax: 80,
  valueMin: 10,
  is3D: false,
  heightMax: 500,
  showMesh: false,
  radius: 1,
};

appInstance.uniCall('updateHeatMapLayerStyle', jsonData, (result) => {
  console.log(result);
});
```

#### 参数描述

| 属性      | 类型    | 说明                                                                                                                                                                                  | 端渲染             | 流渲染 |
| --------- | ------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------ | ------ |
| id        | String  | 图层对象 id，新建时调用者自己传入的唯一标识，用于各种操作的对象识别                                                                                                                   | 支持               | 支持   |
| type      | String  | 外观类型，default：标准热图；dot：点状热图；temperature：温度热图（反距离加权算法，颜色使用的是 valueStep 和 setpColor ，不支持 colorMin 和 colorMax）                                | 不支持 temperature | 支持   |
| alpha     | Number  | 透明度，0：完全透明；1：完全不透明                                                                                                                                                    | 支持               | 支持   |
| colorMax  | Number  | 最大值上限颜色（HEX 颜色值）                                                                                                                                                          | 支持               | 支持   |
| colorMin  | Number  | 最小值下限颜色（HEX 颜色值）                                                                                                                                                          | 支持               | 支持   |
| valueStep | Number  | 热图颜色渐变分段，valueMin 数值对应 0，valueMax 为 1.0，其中可以添加任意个比例分段。非必选参数，当 valueStep、stepColor、valueMax、valueMin 不为空时，colorMax 和 colorMin 不起作用。 | 支持               | 支持   |
| stepColor | Number  | 热图颜色渐变分段，根据 valueStep 分段后段渐变的颜色                                                                                                                                   | 支持               | 支持   |
| valueMax  | Number  | 最大值上限                                                                                                                                                                            | 支持               | 支持   |
| valueMin  | Number  | 最小值下限                                                                                                                                                                            | 支持               | 支持   |
| is3D      | Boolean | 是否三维柱图，true: 是三维柱图，false: 不是。默认不是。                                                                                                                               | 不支持             | 支持   |
| heightMax | Number  | 三维柱的最大高度(单位: 米)                                                                                                                                                            | 不支持             | 支持   |
| showMesh  | Boolean | 三维柱图的样式，true: 显示面，false: 只显示网格体。默认: false                                                                                                                        | 不支持             | 支持   |
| radius    | Number  | 每一个点得半径单位（米）                                                                                                                                                              | 支持               | 支持   |

#### 回调数据

```json
{
  "result": 1,
  "message": "成功。"
}
```

#### 回调数据参数描述

| 属性    | 类型   | 说明                     |
| ------- | ------ | ------------------------ |
| result  | Number | 1：代表成功；0：代表失败 |
| message | String | 成功或者失败原因         |

[返回本章目录](#目录)

## 4.删除热力图

### 功能描述

删除热力图

### 调用方法

```js
let jsonData = {
  id: 'heat',
  overlayType: 'heatMapLayer',
};

appInstance.uniCall('removeOverlay', jsonData, (result) => {
  console.log(result);
});
```

#### 参数描述

| 属性        | 类型   | 说明                                                                |
| ----------- | ------ | ------------------------------------------------------------------- |
| id          | String | 图层对象 id，新建时调用者自己传入的唯一标识，用于各种操作的对象识别 |
| overlayType | String | 图层对象类别                                                        |

#### 回调数据

```json
{
  "result": 1,
  "message": "成功。"
}
```

#### 回调数据参数描述

| 属性    | 类型   | 说明                     |
| ------- | ------ | ------------------------ |
| result  | Number | 1：代表成功；0：代表失败 |
| message | String | 成功或者失败原因         |

### 流渲染效果图

<img src="./contents/mediaFiles/images/overlay/heat-streaming.png" width = "544" height="405" alt="系统架构图" />

### 端渲染效果图

<img src="./contents/mediaFiles/images/overlay/heatmapLayerImg.jpg" width = "544" height="405" alt="系统架构图" />

[返回本章目录](#目录)
