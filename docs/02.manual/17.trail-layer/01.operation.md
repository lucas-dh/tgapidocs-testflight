# 轨迹图操作

## 目录

- [1.添加轨迹图](#1添加轨迹图)
- [2.更新轨迹图数据](#2更新轨迹图数据)
- [3.更新轨迹图样式](#3更新轨迹图样式)
- [4.删除轨迹图](#4删除轨迹图)

## 1.添加轨迹图

### 功能描述

在三维场景中添加轨迹图

### 调用方法

```js
let jsonData = {
  id: 'trail',
  name: '轨迹图',
  coordType: 0,
  coordTypeZ: 0,
  trackStyle: 'style001',
  trackDuration: 10,
  iconRotate: 'disable',
  objLife: 30,
  trackWidth: 10,
  trackVisible: 'ShowAll',
  duration: 1,
  visible: true,
  tags: ['tag1', 'tag2', 'tag3'],
  legends: [
    {
      name: 'trail1',
      iconName: 'car',
      iconScale: 1,
      labelScale: 1,
      trackColor: '#ff0000',
    },
    {
      name: 'trail2',
      iconName: 'taxi',
      iconScale: 1,
      labelScale: 1,
      trackColor: '#99ECFB',
    },
    {
      name: 'trail3',
      iconName: 'ambulance',
      iconScale: 1,
      labelScale: 1,
      trackColor: '#fff000',
    },
  ],
  data: [
    {
      id: '1',
      label: '车辆',
      coord: [113.94253645437603, 22.517767045578417], //以深圳湾经纬度为例
      coordZ: 64,
      yaw: 0,
      type: 'trail1',
    },
    {
      id: '2',
      label: '出租车',
      coord: [113.94250752173252, 22.51745512153193],
      coordZ: 64,
      yaw: 0,
      type: 'trail2',
    },
    {
      id: '3',
      label: '救护车',
      coord: [113.94242169411297, 22.516959329507735],
      coordZ: 64,
      yaw: 0,
      type: 'trail3',
    },
  ],
};

appInstance.uniCall('addTrailLayer', jsonData, (result) => {
  console.result(result);
});
```

#### 参数描述

| 属性                  | 类型    | 说明                                                                                                                   | 端渲染 | 流渲染 |
| --------------------- | ------- | ---------------------------------------------------------------------------------------------------------------------- | ------ | ------ |
| id                    | String  | 图层对象 id，新建时调用者自己传入的唯一标识，用于各种操作的对象识别                                                    | 支持   | 支持   |
| name                  | String  | 图层名称，支持为图层自定义名称                                                                                         | 支持   | 支持   |
| coordType             | Number  | XY 轴坐标类别，0：X 经度，Y 纬度；1：X 米，Y 米，相对世界 00 点 目前该属性仅支持属性值为 0                             | 支持   | 支持   |
| coordTypeZ            | Number  | Z 轴坐标类别，0：相对 3D 世界 0 海拔；1：相对 3D 世界地表；2：相对 3D 模型表面（单位：米） 目前该属性仅支持属性值为 0  | 支持   | 支持   |
| trackStyle            | String  | 尾迹内置风格                                                                                                           | 支持   | 支持   |
| trackDuration         | Number  | 尾迹粒子生命周期                                                                                                       | 支持   | 支持   |
| iconRotate            | String  | 图标是否旋转，"disable"，不旋转，默认值；"auto"，根据前一位置自动计算旋转；“manual"：根据 data 里对象的 yaw 属性指定。 | 支持   | 支持   |
| objLife               | Number  | 批号消批时间长度                                                                                                       | 支持   | 支持   |
| trackWidth            | Number  | 尾迹粒子的宽度                                                                                                         | 支持   | 支持   |
| trackVisible          | String  | 尾迹显示状态，"ShowAll"：显示所有对象尾迹，"HideAll"：隐藏所有对象尾迹，"对象 Id"：只显示当前图层特定对象 Id 的尾迹    | 支持   | 不支持 |
| duration              | Number  | 从上一位置移动到新位置花费的时间长度（单位，秒）这里的值是更新数据可以使用的默认值度                                   | 支持   | 支持   |
| visible               | Number  | 添加当前图层时默认显示还是隐藏度                                                                                       | 支持   | 支持   |
| tags                  | Array   | 用户自定标签数组，用于保存用户的扩展数据，或者可以控制显隐                                                             | 不支持 | 支持   |
| legends               | Array   | 定义图层包含图例，支持为不同图例定义各自样式                                                                           | 支持   | 支持   |
| legends[0].name       | String  | 图层内图例名称，新建时调用者自己传入的唯一名称，用于各种操作的图例识别                                                 | 支持   | 支持   |
| legends[0].iconName   | String  | 内置图标名称，或根据项目，在场景中预置好的图标对象的名称，包含文字样式定义，具体图标名称参考下表和下图                 | 支持   | 支持   |
| legends[0].iconScale  | Number  | 默认值是 1 表示原大，0 - 1：表示缩小倍率，大于 1：表示放大倍率                                                         | 支持   | 支持   |
| legends[0].labelScale | Number  | 默认值是 1 表示原大，0 - 1：表示缩小倍率，大于 1：表示放大倍率                                                         | 支持   | 支持   |
| legends[0].trackColor | String  | 轨迹颜色（HEX 颜色值）                                                                                                 | 支持   | 支持   |
| data                  | Array   | 定义图层可视化数据                                                                                                     | 支持   | 支持   |
| data[0].id            | String  | 图层子对象 id，新建时调用者自己传入的唯一标识，用于各种操作的对象识别                                                  | 支持   | 支持   |
| data[0].label         | String  | 图标标签文本                                                                                                           | 支持   | 支持   |
| data[0].coord         | Array   | XY 轴坐标，X：经度；Y：纬度                                                                                            | 支持   | 支持   |
| data[0].coordZ        | Number  | z 轴高度(单位:米)                                                                                                      | 支持   | 支持   |
| data[0].yaw           | Number  | 图标旋转的角度，当 iconRoate 为"manual"的时候生效                                                                      | 支持   | 支持   |
| data[0].type          | String  | 数据点图例类别                                                                                                         | 支持   | 支持   |

#### 回调数据

```json
{
  "result": 1,
  "message": "成功。"
}
```

#### 回调数据参数描述

| 属性    | 类型   | 说明                     |
| ------- | ------ | ------------------------ |
| result  | Number | 1：代表成功；0：代表失败 |
| message | String | 成功或者失败原因         |

### 具体内置图标名称（iconName）详情

<table>
    <tr>
      <th>图标类型</th>
      <th>图标名称</th>
    </tr>
    <tr>
      <td rowspan="15" style="text-align:left;">市政设施</td>
      <td>camera</td>
    </tr>
    <tr>
      <td>streetlamp</td>
    </tr>
    <tr>
      <td>manholecover</td>
    </tr>
    <tr>
      <td>sensor</td>
    </tr>
    <tr>
      <td>utilitypole</td>
    </tr>
    <tr>
      <td>transmission</td>
    </tr>
    <tr>
      <td>broadcast</td>
    </tr>
    <tr>
      <td>wifi</td>
    </tr>
    <tr>
      <td>firehydrant</td>
    </tr>
    <tr>
      <td>equipmentbox</td>
    </tr>
    <tr>
      <td>trafficlight</td>
    </tr>
    <tr>
      <td>charge</td>
    </tr>
    <tr>
      <td>gasstation</td>
    </tr>
    <tr>
      <td>wc</td>
    </tr>
    <tr>
      <td>dustbin</td>
    </tr>
    <tr>
      <td rowspan="20" style="text-align:left;">地点建筑</td>
      <td>trainstation</td>
    </tr>
    <tr>
      <td>airport</td>
    </tr>
    <tr>
      <td>anchor</td>
    </tr>
    <tr>
      <td>government</td>
    </tr>
    <tr>
      <td>netpoint</td>
    </tr>
    <tr>
      <td>metro</td>
    </tr>
    <tr>
      <td>finance</td>
    </tr>
    <tr>
      <td>school</td>
    </tr>
    <tr>
      <td>hospital</td>
    </tr>
    <tr>
      <td>factory</td>
    </tr>
    <tr>
      <td>constructionsite</td>
    </tr>
    <tr>
      <td>residence</td>
    </tr>
    <tr>
      <td>mergencyshelter</td>
    </tr>
    <tr>
      <td>park</td>
    </tr>
    <tr>
      <td>diningroom</td>
    </tr>
    <tr>
      <td>warehouse</td>
    </tr>
    <tr>
      <td>store</td>
    </tr>
    <tr>
      <td>tollgate</td>
    </tr>
    <tr>
      <td>officebuilding</td>
    </tr>
    <tr>
      <td>busstation</td>
    </tr>
    <tr>
      <td rowspan="5" style="text-align:left;">人员</td>
      <td>people</td>
    </tr>
    <tr>
      <td>policeman</td>
    </tr>
    <tr>
      <td>doctor</td>
    </tr>
    <tr>
      <td>specialpeople</td>
    </tr>
    <tr>
      <td>criminal</td>
    </tr>
    <tr>
      <td rowspan="15" style="text-align:left;">交通</td>
      <td>car</td>
    </tr>
    <tr>
      <td>policecar</td>
    </tr>
    <tr>
      <td>fireengine</td>
    </tr>
    <tr>
      <td>ambulance</td>
    </tr>
    <tr>
      <td>taxi</td>
    </tr>
    <tr>
      <td>truck</td>
    </tr>
    <tr>
      <td>bus</td>
    </tr>
    <tr>
      <td>newscar</td>
    </tr>
    <tr>
      <td>militarycar</td>
    </tr>
    <tr>
      <td>municipal</td>
    </tr>
    <tr>
      <td>electriccar</td>
    </tr>
    <tr>
      <td>watercar</td>
    </tr>
    <tr>
      <td>train</td>
    </tr>
    <tr>
      <td>ship</td>
    </tr>
    <tr>
      <td>cargoship</td>
    </tr>
    <tr>
      <td rowspan="5" style="text-align:left;">飞行器</td>
      <td>airplane</td>
    </tr>
    <tr>
      <td>helicopter</td>
    </tr>
    <tr>
      <td>uav</td>
    </tr>
    <tr>
      <td>satellite</td>
    </tr>
    <tr>
      <td>rocket</td>
    </tr>
    <tr>
      <td rowspan="3" style="text-align:left;">事件</td>
      <td>event_01</td>
    </tr>
    <tr>
      <td>event_03</td>
    </tr>
    <tr>
      <td>event_03</td>
    </tr>
    <tr>
      <td rowspan="4" style="text-align:left;">通用</td>
      <td>icon_01</td>
    </tr>
    <tr>
      <td>icon_02</td>
    </tr>
    <tr>
      <td>icon_03</td>
    </tr>
    <tr>
      <td>icon_04</td>
    </tr>
    <tr>
      <td rowspan="3" style="text-align:left;">地名</td>
      <td>site_01</td>
    </tr>
    <tr>
      <td>site_02</td>
    </tr>
    <tr>
      <td>site_03</td>
    </tr>
</table>

### 具体内置图标名称（iconName）效果

<img src="./contents/mediaFiles/images/iconName.jpg" width = "1344" height = "765" alt="图标效果" />

[返回本章目录](#目录)

## 2.更新轨迹图数据

### 功能描述

更新三维场景中添加轨迹图的数据

### 调用方法

```js
let jsonData = [
  {
    id: 'trail',
    name: '轨迹图',
    coordType: 0,
    coordTypeZ: 0,
    isAppend: true,
    duration: 1,
    tags: ['tag1', 'tag2', 'tag3'],
    data: [
      {
        id: '1',
        label: '车辆',
        coord: [113.94149510312201, 22.5184602916402], //以深圳湾经纬度为例
        coordZ: 64,
        yaw: 0,
        type: 'trail1',
      },
      {
        id: '2',
        label: '出租车',
        coord: [113.94153800905801, 22.5188561825677],
        coordZ: 64,
        yaw: 0,
        type: 'trail2',
      },
      {
        id: '3',
        label: '救护车',
        coord: [113.9410898356404, 22.51712621919618],
        coordZ: 64,
        yaw: 0,
        type: 'trail3',
      },
    ],
  },
  {
    id: 'trail',
    name: '轨迹图',
    coordType: 0,
    coordTypeZ: 0,
    isAppend: true,
    data: [
      {
        id: '1',
        label: '车辆',
        coord: [113.938538747031, 22.517514577038998],
        coordZ: 64,
        yaw: 0,
        type: 'trail1',
      },
      {
        id: '2',
        label: '出租车',
        coord: [113.94057449680801, 22.519552225426498],
        coordZ: 64,
        yaw: 0,
        type: 'trail2',
      },
      {
        id: '3',
        label: '救护车',
        coord: [113.93980484148894, 22.517247949875152],
        coordZ: 64,
        yaw: 0,
        type: 'trail3',
      },
    ],
  },
  {
    id: 'trail',
    name: '轨迹图',
    coordType: 0,
    coordTypeZ: 0,
    isAppend: true,
    data: [
      {
        id: '1',
        label: '车辆',
        coord: [113.93748931711, 22.5171407337309],
        coordZ: 64,
        yaw: 0,
        type: 'trail1',
      },
      {
        id: '2',
        label: '出租车',
        coord: [113.939331421293, 22.5195548497074],
        coordZ: 64,
        yaw: 0,
        type: 'trail2',
      },
      {
        id: '3',
        label: '救护车',
        coord: [113.9387334658695, 22.517349181622148],
        coordZ: 64,
        yaw: 0,
        type: 'trail3',
      },
    ],
  },
  {
    id: 'trail',
    name: '轨迹图',
    coordType: 0,
    coordTypeZ: 0,
    isAppend: true,
    data: [
      {
        id: '1',
        label: '车辆',
        coord: [113.93633198843501, 22.5168850589012],
        coordZ: 64,
        yaw: 0,
        type: 'trail1',
      },
      {
        id: '2',
        label: '出租车',
        coord: [113.93755306618401, 22.5196375039936],
        coordZ: 64,
        yaw: 0,
        type: 'trail2',
      },
      {
        id: '3',
        label: '救护车',
        coord: [113.93696603478713, 22.517728763767064],
        coordZ: 64,
        yaw: 0,
        type: 'trail3',
      },
    ],
  },
];
for (let i = 0; i < jsonData.length; i++) {
  setTimeout(() => {
    appInstance.uniCall('updateTrailLayerCoord', jsonData[i], (result) => {
      console.log(result);
    });
  }, i * 1000);
}
```

#### 参数描述

| 属性           | 类型    | 说明                                                                                                                 | 端渲染 | 流渲染 |
| -------------- | ------- | -------------------------------------------------------------------------------------------------------------------- | ------ | ------ |
| id             | String  | 图层对象 id，新建时调用者自己传入的唯一标识，用于各种操作的对象识别                                                  | 支持   | 支持   |
| name           | String  | 图层名称，支持为图层自定义名称                                                                                       | 支持   | 支持   |
| coordType      | String  | XY 轴坐标类别，0：X 经度，Y 纬度；1：X 米，Y 米，相对世界 00 点 目前该属性仅支持属性值为 0                           | 支持   | 支持   |
| coordTypeZ     | Number  | Z 轴坐标类别，0：相对 3D 世界 0 海拔；1：相对 3D 世界地表；2：相对 3D 模型表面（单位：米）目前该属性仅支持属性值为 0 | 支持   | 支持   |
| isAppend       | Boolean | 是否追加数据（按数据顺序），true：按新数据 更新原有重复数据 & 追加新数据；false：清除原有数据 & 重建新数据           | 支持   | 支持   |
| duration       | Number  | 从上一位置移动到这个新位置花费的时间长度（单位，秒）这里的值优先级高于 addTrailLayer 中的 duration 值                | 支持   | 支持   |
| tags           | Array   | 用户自定标签数组，用于保存用户的扩展数据，或者可以控制显隐                                                           | 不支持 | 支持   |
| data           | Array   | 定义图层可视化数据                                                                                                   | 支持   | 支持   |
| data[0].id     | String  | 图层子对象 id，新建时调用者自己传入的唯一标识，用于各种操作的对象识别                                                | 支持   | 支持   |
| data[0].label  | String  | 图标标签文本                                                                                                         | 支持   | 支持   |
| data[0].coord  | Array   | XY 轴坐标，X：经度；Y：纬度                                                                                          | 支持   | 支持   |
| data[0].coordZ | Number  | Z 轴高度（单位：米）                                                                                                 | 支持   | 支持   |
| data[0].yaw    | Number  | 图标旋转的角度，当 iconRoate 为"manual"的时候生效                                                                    | 支持   | 支持   |
| data[0].type   | String  | 数据点图例类别                                                                                                       | 支持   | 支持   |

#### 回调数据

```json
{
  "result": 1,
  "message": "成功。"
}
```

#### 回调数据参数描述

| 属性    | 类型   | 说明                     |
| ------- | ------ | ------------------------ |
| result  | Number | 1：代表成功；0：代表失败 |
| message | String | 成功或者失败原因         |

[返回本章目录](#目录)

## 3.更新轨迹图样式

### 功能描述

更新三维场景中添加轨迹图的样式

### 调用方法

```js
let jsonData = {
  id: 'trail',
  trackStyle: 'style001',
  trackDuration: 5,
  trackWidth: 10,
  trackVisible: 'ShowAll',
  iconRotate: 'disable',
  objLife: 10,
  isAppend: true,
  legends: [
    {
      name: 'trail1',
      iconName: 'inspect',
      iconScale: 1,
      labelScale: 1,
      trackColor: '#00BFFF',
    },
    {
      name: 'trail2',
      iconName: 'firehydrant',
      iconScale: 1,
      labelScale: 1,
      trackColor: '#D96D00',
    },
  ],
};

appInstance.uniCall('updateTrailLayerStyle', jsonData, (result) => {
  console.log(result);
});
```

#### 参数描述

| 属性                  | 类型    | 说明                                                                                                                   | 端渲染 | 流渲染 |
| --------------------- | ------- | ---------------------------------------------------------------------------------------------------------------------- | ------ | ------ |
| id                    | String  | 图层子对象 id，新建时调用者自己传入的唯一标识，用于各种操作的对象识别                                                  | 支持   | 支持   |
| trackStyle            | String  | 尾迹内置风格                                                                                                           | 支持   | 支持   |
| trackDuration         | Number  | 尾迹粒子生命周期                                                                                                       | 支持   | 支持   |
| trackWidth            | Number  | 尾迹粒子的宽度                                                                                                         | 支持   | 支持   |
| trackVisible          | String  | 尾迹显示状态，"ShowAll"：显示所有对象尾迹，"HideAll"：隐藏所有对象尾迹，"对象 Id"：只显示当前图层特定对象 Id 的尾迹    | 支持   | 不支持 |
| iconRotate            | String  | 图标是否旋转，"disable"，不旋转，默认值；"auto"，根据前一位置自动计算旋转；“manual"：根据 data 里对象的 yaw 属性指定。 | 支持   | 支持   |
| objLife               | Number  | 批号消批时间长度                                                                                                       | 支持   | 支持   |
| isAppend              | Boolean | 是否追加数据（按数据顺序），true：按新数据 更新原有重复数据 & 追加新数据；false：清除原有数据 & 重建新数据             | 支持   | 支持   |
| legends               | Array   | 定义图层包含图例，支持为不同图例定义各自样式                                                                           | 支持   | 支持   |
| legends[0].name       | String  | 图层内图例名称，新建时调用者自己传入的唯一名称，用于各种操作的图例识别                                                 | 支持   | 支持   |
| legends[0].iconName   | String  | 内置图标名称，或根据项目，在场景中预置好的图标对象的名称，包含文字样式定义，具体图标名称参考下表和下图                 | 支持   | 支持   |
| legends[0].iconScale  | Number  | 默认值是 1 表示原大，0 - 1：表示缩小倍率，大于 1：表示放大倍率                                                         | 支持   | 支持   |
| legends[0].labelScale | Number  | 默认值是 1 表示原大，0 - 1：表示缩小倍率，大于 1：表示放大倍率                                                         | 支持   | 支持   |
| legends[0].trackColor | String  | 轨迹颜色（HEX 颜色值）                                                                                                 | 支持   | 支持   |

#### 回调数据

```json
{
  "result": 1,
  "message": "成功。"
}
```

#### 回调数据参数描述

| 属性    | 类型   | 说明                     |
| ------- | ------ | ------------------------ |
| result  | Number | 1：代表成功；0：代表失败 |
| message | String | 成功或者失败原因         |

[返回本章目录](#目录)

## 4.删除轨迹图

### 功能描述

删除轨迹图

### 调用方法

```js
let jsonData = {
  id: 'trail',
  overlayType: 'trailLayer',
};

appInstance.uniCall('removeOverlay', jsonData, (result) => {
  console.log(result);
});
```

#### 参数描述

| 属性        | 类型   | 说明                                                                |
| ----------- | ------ | ------------------------------------------------------------------- |
| id          | String | 图层对象 id，新建时调用者自己传入的唯一标识，用于各种操作的对象识别 |
| overlayType | String | 图层对象类别                                                        |

#### 回调数据

```json
{
  "result": 1,
  "message": "成功。"
}
```

#### 回调数据参数描述

| 属性    | 类型   | 说明                     |
| ------- | ------ | ------------------------ |
| result  | Number | 1：代表成功；0：代表失败 |
| message | String | 成功或者失败原因         |

### 流渲染效果图

<img src="./contents/mediaFiles/images/overlay/trailLayerImg-Streaming.png" width = "544" height="405" alt="系统架构图" />

### 端渲染效果图

<img src="./contents/mediaFiles/images/overlay/trailLayerImg.png" width = "544" height="405" alt="系统架构图" />

[返回本章目录](#目录)
