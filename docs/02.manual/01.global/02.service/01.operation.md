# 服务调度操作

## 目录

- [1.初始化服务](#1初始化服务)
- [2.预读取服务](#2预读取服务)
- [3.切换服务](#3切换服务)
- [4.获取服务信息](#4获取服务信息)

## 1.初始化服务

### 功能描述

初始化服务（加载默认服务）

### 流渲染调用方法

```js
appInstance.initService(
  {
    name: '默认',
    container: document.getElementById('container'),
    mode: 'streaming',
    token: 'XXX', //token获取参见快速上手流渲染初始化相关代码
    url: '192.168.X.X',
    sceneName: 'sceneName',
    stateName: 'stateName',
    editMode: false,
  },
  (result) => {
    appInstance.uniCall(
      'addEventListener',
      {
        eventName: 'onServiceInit',
        callback: (res) => {
          console.log(res);
        },
      },
      (result) => {
        console.log(result);
      }
    );
  }
);
```

#### 参数描述

| 属性      | 类型    | 说明                                                                   |
| --------- | ------- | ---------------------------------------------------------------------- |
| name      | String  | 服务名称，用于切换服务时使用                                           |
| url       | String  | 流渲染服务器地址                                                       |
| mode      | String  | streaming 代表流渲染                                                   |
| token     | String  | 流渲染加载 token 值                                                    |
| container | String  | 场景 dom 容器                                                          |
| sceneName | String  | 初始化服务后立即进入的场景名称，如果不写则进入默认场景（只支持流渲染） |
| stateName | String  | 初始化服务后立即进入的状态名称，如果不写则进入默认状态                 |
| editMode  | Boolean | 是否开启编辑模式，默认不开启，编辑模式的鼠标交互和非编辑模式的不同     |

#### 流渲染回调数据

```json
{
  "result": 1,
  "message": "成功。"
}
```

#### 回调数据参数描述

| 属性    | 类型   | 说明                     |
| ------- | ------ | ------------------------ |
| result  | Number | 1：代表成功；0：代表失败 |
| message | String | 成功或者失败原因         |

### 端渲染调用方法

```js
fetch('https://www.tuguan.net/api/user/v1/visitorScene/m64gzmtc', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({}),
})
  .then((response) => response.json())
  .then((data) => {
    if (data.success && data.accessToken) {
      this.initService(data.accessToken);
    } else {
      console.error('获取token失败', data);
      this.loading = false;
    }
  })
  .catch((error) => {
    console.error('获取token错误:', error);
    this.loading = false;
  });

appInstance.initService(
  {
    container: document.getElementById('container'),
    mode: 'scene',
    token: 'XXX', //token获取参见快速上手端渲染初始化相关代码
    url: '192.168.X.X', //场景发布地址
    resolution: [1920, 1080],
    editMode: false,
  },
  (result) => {
    console.log(result);
  }
);
```

注意事项：端渲染加载需要有 2 步式请求，获取到 token。具体可以参考 <a href="index.html?start.install" target="_blank">开始指南 安装引用 端渲染部分</a>。

#### 参数描述

| 属性       | 类型    | 说明                                                               |
| ---------- | ------- | ------------------------------------------------------------------ |
| container  | String  | 场景 dom 容器                                                      |
| mode       | String  | scene 代表端渲染                                                   |
| token      | String  | 端渲染模型授权码                                                   |
| url        | String  | 端渲染模型地址                                                     |
| resolution | Array   | 控件 像素分辨率，宽，高，如果不写会自动适应画布容器大小。          |
| editMode   | Boolean | 是否开启编辑模式，默认不开启，编辑模式的鼠标交互和非编辑模式的不同 |

#### 端渲染回调数据

```json
{
  "result": 1,
  "message": "成功。"
}
```

#### 回调数据参数描述

| 属性    | 类型   | 说明                     |
| ------- | ------ | ------------------------ |
| result  | Number | 1：代表成功；0：代表失败 |
| message | String | 成功或者失败原因         |

[返回本章目录](#目录)

## 2.预读取服务

### 功能描述

预读取服务

### 调用方法

```js
let jsonData = {
  name: 'serviceName', // 服务名称
  url: 'serviceUrl', // 服务地址
  mode: 'scene', // 服务模式 scene 端渲染 , streaming 流渲染
  token: 'serviceTolen', // 服务Token
};

appInstance.uniCall('loadService', jsonData, (result) => {
  console.log(result);
});
```

#### 参数描述

| 属性  | 类型   | 说明                                     |
| ----- | ------ | ---------------------------------------- |
| name  | String | 服务名称                                 |
| url   | String | 服务地址                                 |
| mode  | String | 服务模式 scene 端渲染 , streaming 流渲染 |
| token | String | 服务 Token                               |

#### 回调数据

```json
{
  "result": 1,
  "message": "成功。"
}
```

#### 回调数据参数描述

| 属性    | 类型   | 说明                     |
| ------- | ------ | ------------------------ |
| result  | Number | 1：代表成功；0：代表失败 |
| message | String | 成功或者失败原因         |

[返回本章目录](#目录)

## 3.切换服务

### 功能描述

切换服务

### 调用方法

```js
let jsonData = {
  name: 'serviceName', // 服务名称
};
appInstance.uniCall('switchService', jsonData, (result) => {
  console.log(result);
});
```

#### 参数描述

| 属性 | 类型   | 说明     |
| ---- | ------ | -------- |
| name | String | 服务名称 |

#### 回调数据

```json
{
  "result": 1,
  "message": "成功。"
}
```

#### 回调数据参数描述

| 属性    | 类型   | 说明                     |
| ------- | ------ | ------------------------ |
| result  | Number | 1：代表成功；0：代表失败 |
| message | String | 成功或者失败原因         |

[返回本章目录](#目录)

## 4.获取服务信息

### 功能描述

获取服务信息

### 调用方法

```js
appInstance.uniCall('getServicesInfo', {}, (result) => {
  console.log(result);
});
```

#### 回调数据

```json
{
  "result": 1,
  "message": "成功。",
  "mode": "streaming",
  "services": [
    {
      "name": "serviceName1", // 场景名称
      "default": true, // true 默认场景；false 非默认场景。只能有一个默认场景
      "url": "https://www.tuguan.net/scenes/abc", // 服务地址
      "token": "ABCDEFG" // token,服务地址token
    },
    {
      "name": "serviceName2",
      "default": false,
      "url": "https://www.tuguan.net/scenes/abc",
      "token": "ABCDEFG"
    }
  ]
}
```

#### 回调数据参数描述

| 属性                | 类型   | 说明                                                |
| ------------------- | ------ | --------------------------------------------------- |
| result              | Number | 1：代表成功；0：代表失败                            |
| message             | String | 成功或者失败原因                                    |
| mode                | String | 成功或者失败原因                                    |
| services            | Array  | 成功或者失败原因                                    |
| services[0].name    | String | 场景名称                                            |
| services[0].default | String | true 默认场景；false 非默认场景。只能有一个默认场景 |
| services[0].url     | String | 服务地址                                            |
| services[0].token   | String | token,服务地址 token                                |

[返回本章目录](#目录)
