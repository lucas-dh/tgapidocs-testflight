# 场景调度操作

## 目录

- [1.切换场景](#1切换场景-流)
- [2.飞入切换场景](#2飞入切换场景-流)
- [3.设置场景效果参数](#3设置场景效果参数)
- [4.获取场景信息](#4获取场景信息)

## 1.切换场景 <span style="width: 40px;height: 21px;display:inline-block;background: #0fcccc;margin-left: 5px;line-height: 19px;"><span style="width: 100%;height: 100%;background: url(./img/stream.png) no-repeat 4px 5px;background-size: 12px 10px;text-indent: 22px;font-size: 12px;color: #ffffff;line-height: 20px;display:inline-block;vertical-align: top;">流</span></span>

### 功能描述

切换场景

### 调用方法

```js
let jsonData = {
  name: 'sceneName',
  serviceName: 'service1',
  coordType: 0,
  coordTypeZ: 0,
  centerCoord: [103.956291, 1.406699],
  coordZ: 150,
  distance: 1000,
  pitch: 30,
  heading: 0,
  duration: 2,
};

appInstance.uniCall('switchScene', jsonData, (result) => {
  console.log(result);
});
```

#### 参数描述

| 属性        | 类型   | 说明                                                                                       |
| ----------- | ------ | ------------------------------------------------------------------------------------------ |
| name        | String | 只在流渲染中工作                                                                           |
| serviceName | String | 场景所属的服务，如果场景是当前服务的，可以不写。服务需要先通过 loadService 加载。          |
| coordType   | Number | XY 轴坐标类别，0：X 经度，Y 纬度；1：X 米，Y 米，相对世界 00 点                            |
| coordTypeZ  | Number | Z 轴坐标类别，0：相对 3D 世界 0 海拔；1：相对 3D 世界地表；2：相对 3D 模型表面（单位：米） |
| centerCoord | Array  | 进入场景视点的默认中心点的坐标 lng,lat                                                     |
| coordZ      | Number | 进入场景视点的默认 Z 轴高度（单位：米）                                                    |
| distance    | Number | 进入场景摄像机的默认镜头距视点距离(单位:米)                                                |
| pitch       | Number | 进入场景摄像机的默认镜头俯仰角(5~89)                                                       |
| heading     | Number | 镜头偏航角(0 正北, 0~359)                                                                  |
| duration    | Number | 切换场景过渡的时间长度，会插入渐隐渐显效果，单位：秒                                       |

#### 回调数据

```js
{
  result: 1,
  message: '成功。',
}
```

#### 回调数据参数描述

| 属性    | 类型   | 说明                     |
| ------- | ------ | ------------------------ |
| result  | Number | 1：代表成功；0：代表失败 |
| message | String | 成功或者失败原因         |

[返回本章目录](#目录)

## 2.飞入切换场景 <span style="width: 40px;height: 21px;display:inline-block;background: #0fcccc;margin-left: 5px;line-height: 19px;"><span style="width: 100%;height: 100%;background: url(./img/stream.png) no-repeat 4px 5px;background-size: 12px 10px;text-indent: 22px;font-size: 12px;color: #ffffff;line-height: 20px;display:inline-block;vertical-align: top;">流</span></span>

### 功能描述

飞入切换场景

### 调用方法

```js
let jsonData = {
  name: 'sceneName',
  coordType: 0,
  coordTypeZ: 0,
  centerCoord: [103.956291, 1.406699],
  coordZ: 150,
  distance: 1000,
  pitch: 30,
  heading: 0,
  duration: 2,
  direction: 'down',
  showCloud: true,
};

appInstance.uniCall('flyToScene', jsonData, (result) => {
  console.log(result);
});
```

#### 参数描述

| 属性        | 类型    | 说明                                                                                                       |
| ----------- | ------- | ---------------------------------------------------------------------------------------------------------- |
| name        | String  | 切换的目标场景名称                                                                                         |
| coordType   | Number  | XY 轴坐标类别，0：X 经度，Y 纬度；1：X 米，Y 米，相对世界 00 点                                            |
| coordTypeZ  | Number  | Z 轴坐标类别，0：相对 3D 世界 0 海拔；1：相对 3D 世界地表；2：相对 3D 模型表面（单位：米）                 |
| centerCoord | Array   | 进入场景视点的默认中心点的坐标 lng,lat                                                                     |
| coordZ      | Number  | 进入场景视点的默认 Z 轴高度（单位：米）                                                                    |
| distance    | Number  | 进入场景摄像机的默认镜头距视点距离(单位:米)                                                                |
| pitch       | Number  | 进入场景摄像机的默认镜头俯仰角(5~89)                                                                       |
| heading     | Number  | 镜头偏航角(0 正北, 0~359)                                                                                  |
| duration    | Number  | 切换场景过渡的时间长度，会插入渐隐渐显效果，单位：秒                                                       |
| direction   | Number  | "down", 从地球仪模式下钻到一个新的场景，"up"，从当前场景返回地球仪模式，此时要求 scneName 一定是地球仪模式 |
| showCloud   | Boolean | 当 direction 是 down 的时候，下钻过程中是否显示云层                                                        |

#### 回调数据

```js
{
  result: 1,
  message: '成功。',
}
```

#### 回调数据参数描述

| 属性    | 类型   | 说明                     |
| ------- | ------ | ------------------------ |
| result  | Number | 1：代表成功；0：代表失败 |
| message | String | 成功或者失败原因         |

[返回本章目录](#目录)

## 3.设置场景效果参数

### 功能描述

设置场景效果参数

### 调用方法

```js
let jsonData = {
  lightPower: 1.0,
  lightPowerTip: 1.0,
  isLayerTopMost: true,
  divTipMovingDelay: 200,
  focusDuration: 0.6,
  gis3dtileShadow: true,
  clickColor: '#ff0000',
  clickEdgeWidth: 1,
  tipMoveOnEdge: true,
  labelColorStyle: 'default',
};

appInstance.uniCall('setSceneEffect', jsonData, (result) => {
  console.log(result);
});
```

#### 参数描述

| 属性              | 类型    | 说明                                                                                                                                                                                                                                                                                                                                                              | 端渲染 | 流渲染 |
| ----------------- | ------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------ | ------ |
| lightPower        | Number  | 图层对象中如果带有发光特性的光的亮度，值域范围 0.0 - 10.0，默认 1.0                                                                                                                                                                                                                                                                                               | 支持   | 支持   |
| lightPowerTip     | Number  | 作用于 addModelTip 指令，当 is3D 等于 true 的时候，立体标牌的光照亮度。默认值：1.0，最大值：6.0，最小值：0，值越大 明度越低 透明度越高；值越小 明度越高 透明度越低                                                                                                                                                                                                | 不支持 | 支持   |
| isLayerTopMost    | Boolean | 图层是否盖在所有模型的最前面，此选项作用于全部图层                                                                                                                                                                                                                                                                                                                | 支持   | 支持   |
| divTipMovingDelay | Number  | 使用 HTML Div 方法添加的 Tip 标牌和流画面同步延迟，默认 200（单位毫秒）                                                                                                                                                                                                                                                                                           | 支持   | 支持   |
| focusDuration     | Number  | 所有聚焦接口的聚焦动画的镜头移动时长，值域范围 0-30，单位：秒，默认值：1，如果是 0，则代表瞬间聚焦，没有过渡动画                                                                                                                                                                                                                                                  | 支持   | 支持   |
| gis3dtileShadow   | Boolean | 3dtile 倾斜摄影是否根据光照生成阴影，true：生成阴影，false：无阴影。默认值 true。                                                                                                                                                                                                                                                                                 | 支持   | 支持   |
| clickColor        | String  | 点击或者悬浮包围框的高亮颜色（HEX 颜色值），会有影响的方法：selectModel、pickModel、clickModelType、highlightBuilding、highlightFloor、highlightRoom 事件：onModelClick、onRectModelSelectionResult、onClickModelResult、onClickModelTypeResult、onBuildingClick、onFloorClick、onRoomClick 覆盖物：模型地标图、模型轨迹图、气泡、柱图、栅格图、关系线 的点击事件 | 支持   | 不支持 |
| clickEdgeWidth    | Number  | 选中边线宽度属性，允许值是 1、2、3、4、5                                                                                                                                                                                                                                                                                                                          | 支持   | 不支持 |
| tipMoveOnEdge     | Boolean | overlayTip 和 modelTip，在弹出时碰上屏幕边缘，是否自动移动直到关联对象从屏幕中消失才隐藏，默认是 true。                                                                                                                                                                                                                                                           | 支持   | 支持   |
| labelColorStyle   | String  | 地标点文字标牌背景颜色转换算法，"default": 默认样式，受环境光影响，偏亮；"nonlinear "，非线性转换比较接近二维取色版原始颜色                                                                                                                                                                                                                                       | 不支持 | 支持   |

#### 回调数据

```js
{
  result: 1,
  message: '成功。',
}
```

#### 回调数据参数描述

| 属性    | 类型   | 说明                     |
| ------- | ------ | ------------------------ |
| result  | Number | 1：代表成功；0：代表失败 |
| message | String | 成功或者失败原因         |

[返回本章目录](#目录)

## 4.获取场景信息

### 功能描述

获取场景信息

### 调用方法

```js
appInstance.uniCall('getScenesInfo', {}, (result) => {
  console.log(result);
});
```

#### 回调数据

```js
{
  result: 1,
  message: '成功。',
  mode: 'streaming3',
  scenes: [
    {
      name: 'sceneName1',
      default: true,
      primitiveCoord: "Planner3857",
      url: 'https://www.tuguan.net/scenes/abc',
      token: 'ABCDEFG',
    },
    {
      name: 'sceneName2',
      default: false,
      primitiveCoord: "Planner3857",
      url: 'https://www.tuguan.net/scenes/abc',
      token: 'ABCDEFG',
    },
  ],
  customIcons: [
    {
      name: 'custom-摄像头', //自定义图标名称
      url: '',              //流使用，图标地址，端传空字符串
      bitmap: '',           //端使用，图片流，流传空字符串
    },
  ],
  customModels: ['ModelName1', 'ModeName2', 'ModelName3'],
  customModelsLocalFile: ['ModelName1', 'ModeName2', 'ModelName3'],
  customModelsLocalServer: ['ModelName1', 'ModeName2', 'ModelName3'],
}
```

#### 回调数据参数描述

| 属性                     | 类型    | 说明                                                                                                                                                                                                                    |
| ------------------------ | ------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| result                   | Number  | 1：代表成功；0：代表失败                                                                                                                                                                                                |
| message                  | String  | 成功或者失败原因                                                                                                                                                                                                        |
| mode                     | String  | scene 代表端渲染，streaming 代表流渲染                                                                                                                                                                                  |
| scenes                   | Array   | 场景信息                                                                                                                                                                                                                |
| scenes[0].name           | String  | 场景名称                                                                                                                                                                                                                |
| scenes[0].default        | Boolean | true 默认场景；false 非默认场景。只能有一个默认场景                                                                                                                                                                     |
| scenes[0].primitiveCoord | String  | 场景的原始坐标系统，可能的返回结果：Planner4326，Planner3857，PlannerXYZ，GlobalModel，GlobalGIS。这个原始模型坐标系统，和后续 TGAPI 调用的数据中的 coordType 无关。只是在某种原始模型坐标系统下，某些 TGAPI 尚未兼容。 |
| scenes[0].url            | String  | 场景地址 流渲染为 ""                                                                                                                                                                                                    |
| scenes[0].token          | String  | 场景加载 token 值 流渲染为 ""                                                                                                                                                                                           |
| customIcons              | Array   | 自定义图标                                                                                                                                                                                                              |
| customIcons[0].name      | String  | 自定义图标名称                                                                                                                                                                                                          |
| customIcons[0].url       | String  | 流使用，图标地址，端传空字符串                                                                                                                                                                                          |
| customIcons[0].bitmap    | String  | 端使用，图片流，流传空字符串                                                                                                                                                                                            |
| customModels             | Array   | 场景内模型定义清单 local                                                                                                                                                                                                |
| customModelsLocalFile    | Array   | 流渲染场景目录里文件模型定义清单 localFile                                                                                                                                                                              |
| customModelsLocalServer  | Array   | 流渲染服务器资产目录模型清单 localServer                                                                                                                                                                                |

[返回本章目录](#目录)
